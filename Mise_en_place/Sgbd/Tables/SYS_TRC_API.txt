##
TAG_CHARSET=@€ιθη
##
SYS_TRC_API
=SQL IFNOTEXIST=SYS_TRC_API=
CREATE TABLE SYS_TRC_API (ID_TRACE NUMBER(38) NOT NULL, METHOD VARCHAR2(10), URI VARCHAR2(2000) NOT NULL, DATE_ACTION TIMESTAMP(6) NOT NULL, SM_TRANSACTION_ID VARCHAR2(500), CONSUMER_APP_OID VARCHAR2(500), ASSOCIATE_OID VARCHAR2(500), ROLE_CODE VARCHAR2(500), OTHER_HEADERS CLOB, PARAMETERS CLOB, PAYLOAD CLOB, HTTP_STATUT VARCHAR2(3), CONSTRAINT PK_SYS_TRC_API PRIMARY KEY (ID_TRACE))
##
DELSYS_TRC_API
=SQL IFEXIST=SYS_STATS_REST_API_DELAY=URI=
delete from SYS_TRC_API T where exists (select 1 from SYS_STATS_REST_API_DELAY D where D.ID_TRACE = T.ID_TRACE)
##
MAJSYS_TRC_API
=SQL IFEXIST=SYS_STATS_REST_API_DELAY=URI=
insert into SYS_TRC_API (ID_TRACE, URI,DATE_ACTION,SM_TRANSACTION_ID, CONSUMER_APP_OID, ASSOCIATE_OID, ROLE_CODE, OTHER_HEADERS, PARAMETERS, HTTP_STATUT) (select ID_TRACE, URI,DATE_ACTION,SM_TRANSACTION_ID, CONSUMER_APP_OID, ASSOCIATE_OID, ROLE_CODE, OTHER_HEADERS, PARAMETERS, HTTP_STATUT from SYS_STATS_REST_API_DELAY WHERE URI IS NOT NULL)
##
SYS_TRC_API_ALTER
=SQL=
DECLARE
    mere number;
    fille number;
    altercount number; 
BEGIN
    SELECT COUNT(*) INTO mere FROM SYS_TRC_API;
    SELECT COUNT(*) INTO fille FROM SYS_STATS_REST_API_DELAY;    
    IF mere != fille then
        RETURN;
    END IF;
	 select count(*) into altercount from USER_TAB_COLUMNS where table_name='SYS_STATS_REST_API_DELAY' and COLUMN_NAME in ('URI','DATE_ACTION','SM_TRANSACTION_ID','CONSUMER_APP_OID','ASSOCIATE_OID','ROLE_CODE','OTHER_HEADERS','PARAMETERS','HTTP_STATUT');
    IF altercount != 9 then
        RETURN;
    END IF;
	 execute immediate 'ALTER TABLE SYS_STATS_REST_API_DELAY drop column URI';
	 execute immediate 'ALTER TABLE SYS_STATS_REST_API_DELAY drop column DATE_ACTION';
	 execute immediate 'ALTER TABLE SYS_STATS_REST_API_DELAY drop column SM_TRANSACTION_ID';
	 execute immediate 'ALTER TABLE SYS_STATS_REST_API_DELAY drop column CONSUMER_APP_OID';
	 execute immediate 'ALTER TABLE SYS_STATS_REST_API_DELAY drop column ASSOCIATE_OID';
	 execute immediate 'ALTER TABLE SYS_STATS_REST_API_DELAY drop column ROLE_CODE';
	 execute immediate 'ALTER TABLE SYS_STATS_REST_API_DELAY drop column OTHER_HEADERS';
	 execute immediate 'ALTER TABLE SYS_STATS_REST_API_DELAY drop column PARAMETERS';
	 execute immediate 'ALTER TABLE SYS_STATS_REST_API_DELAY drop column HTTP_STATUT';
END;
##
SYS_TRC_API
=SQL IFNOTEXIST=SYS_TRC_API=PAYLOAD_WITH_DATA_NAME=
ALTER TABLE SYS_TRC_API ADD (PAYLOAD_WITH_DATA_NAME CLOB)
