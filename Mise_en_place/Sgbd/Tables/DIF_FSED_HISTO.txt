##
TAG_CHARSET=@€ιθη
##
DIF_FSED_HISTO
=SQL IFNOTEXIST=DIF_FSED_HISTO=
CREATE TABLE DIF_FSED_HISTO(PERIODE VARCHAR2(6 BYTE)NOT NULL ENABLE,NUMPAC  VARCHAR2(6 BYTE) NOT NULL ENABLE,CLE VARCHAR2(1000 BYTE) NOT NULL ENABLE,PACMAT VARCHAR2(8 BYTE) NOT NULL ENABLE,PAIEZAD VARCHAR2(8 BYTE) NOT NULL ENABLE ,ELEM VARCHAR2(4 BYTE) NOT NULL ENABLE,OCC VARCHAR2(3 BYTE) DEFAULT '   ' NOT NULL ENABLE,VALEUR VARCHAR2(1000 BYTE),CODEOP VARCHAR2(1 BYTE),TYPE_DONNEE VARCHAR2(1 BYTE),DTEFFET DATE,PRIMARY KEY (PERIODE, NUMPAC, CLE, PACMAT,PAIEZAD, ELEM, OCC))PARTITION BY LIST (NUMPAC) SUBPARTITION BY HASH (PERIODE)(PARTITION NUMPAC_PERIODE VALUES (0))
##
DIF_FSED_HISTO_NONPARTITIONNEE
=SQL IFNOTEXIST=DIF_FSED_HISTO_NONPARTITIONNEE=
CREATE table DIF_FSED_HISTO_NONPARTITIONNEE as Select * from DIF_FSED_HISTO
##
DIF_FSED_HISTO
=SQL IFEXIST=DIF_FSED_HISTO=
DROP TABLE DIF_FSED_HISTO
##
DIF_FSED_HISTO
=SQL IFNOTEXIST=DIF_FSED_HISTO=
CREATE TABLE DIF_FSED_HISTO(PERIODE VARCHAR2(6 BYTE)NOT NULL ENABLE,NUMPAC  VARCHAR2(6 BYTE) NOT NULL ENABLE,CLE VARCHAR2(1000 BYTE) NOT NULL ENABLE,PACMAT VARCHAR2(8 BYTE) NOT NULL ENABLE,PAIEZAD VARCHAR2(8 BYTE) NOT NULL ENABLE ,ELEM VARCHAR2(4 BYTE) NOT NULL ENABLE,OCC VARCHAR2(3 BYTE) DEFAULT '   ' NOT NULL ENABLE,VALEUR VARCHAR2(1000 BYTE),CODEOP VARCHAR2(1 BYTE),TYPE_DONNEE VARCHAR2(1 BYTE),DTEFFET DATE)PARTITION BY LIST (NUMPAC) SUBPARTITION BY RANGE (PERIODE)(PARTITION NUMPAC VALUES ('*') (SUBPARTITION NUMPAC_PERIODE values LESS THAN ('0000')))
##
IDX_DIF_FSED_HISTO
=SQL IF_INDEX_NOTEXIST=IDX_DIF_FSED_HISTO=
CREATE UNIQUE INDEX IDX_DIF_FSED_HISTO ON  DIF_FSED_HISTO (PERIODE, NUMPAC, CLE, PACMAT,PAIEZAD, ELEM, OCC) local
##
CREATE_PARTITION_DIF_FSED_HISTO
=SQL=
DECLARE
BEGIN
  BEGIN
    FOR NUMPAC in (SELECT distinct(NUMPAC) NUMPAC from DIF_FSED_HISTO_NONPARTITIONNEE) LOOP
        EXECUTE immediate 'Alter TABLE DIF_FSED_HISTO add partition NUMPAC_'||NUMPAC.NUMPAC||' VALUES('''||NUMPAC.NUMPAC||''')(SUBPARTITION '||NUMPAC.NUMPAC||'_000000  VALUES LESS THAN(''000000'')) ';
    END LOOP;
  
  END;
  
	BEGIN 	
    FOR PERIODE in (SELECT  distinct numpac ,periode,to_char(ADD_MONTHS(TO_DATE(periode,'yyyymm'),1),'yyyymm') as per  from DIF_FSED_HISTO_NONPARTITIONNEE order by numpac,periode,to_char(ADD_MONTHS(TO_DATE(periode,'yyyymm'),1),'yyyymm')  asc)  LOOP
      EXECUTE immediate 'ALTER TABLE DIF_FSED_HISTO  MODIFY PARTITION NUMPAC_'||PERIODE.NUMPAC||' ADD SUBPARTITION '||PERIODE.NUMPAC||'_'||PERIODE.periode||' VALUES LESS THAN ('''||PERIODE.per||''')';
    END LOOP;
   
  END;
END;
##
DIF_FSED_HISTO
==
INSERT into DIF_FSED_HISTO select * from DIF_FSED_HISTO_NONPARTITIONNEE
##
DIF_FSED_HISTO_NONPARTITIONNEE
=SQL IFEXIST=DIF_FSED_HISTO_NONPARTITIONNEE=
DROP TABLE DIF_FSED_HISTO_NONPARTITIONNEE
