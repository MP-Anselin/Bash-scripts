##
TAG_CHARSET=@€ιθη
##
TGE_REF_ENVOI_PAI
=SQL IFNOTEXIST=TGE_REF_ENVOI_PAI=
CREATE TABLE TGE_REF_ENVOI_PAI (ORIGINE VARCHAR2(10), CODE_REQ VARCHAR2(10), ORDRE_REQ VARCHAR2(10), REQUETE CLOB, PRIMARY KEY (ORIGINE,CODE_REQ,ORDRE_REQ))
##
TGE_REF_ENVOI_PAI
==
DELETE FROM TGE_REF_ENVOI_PAI
##
TGE_REF_ENVOI_PAI (ORIGINE,CODE_REQ,ORDRE_REQ,REQUETE)
'RD','PAI2','1','SELECT R.pacmat, R.paiezad, C.numcnt, R.entree AS DEB_EMP, NVL(R.sortie, to_date(''31.12.2099'', ''dd.MM.yyyy'')) AS FIN_EMP, NVL(R.DEBUT_PERIODE_RECUEIL, to_date(''19000101'',''yyyymmdd'')) AS DEB_REC, NVL(R.FIN_PERIODE_RECUEIL, to_date(''19000102'',''yyyymmdd'')) AS FIN_REC, CS.CODE_CHRONO AS CODE_CHRONO FROM tge_periode_recueil_paiezad R JOIN (SELECT numpac, mois_paie, debut_periode_recueil, fin_periode_recueil FROM (SELECT S.numpac, S.mois_paie, S.debut_periode_recueil, S.fin_periode_recueil, COUNT(paiezad) AS nb_Dossier FROM gap_trt_liste_mat T JOIN tge_periode_recueil_paiezad S ON S.numpac = T.numpac AND S.pacmat = T.pacmat WHERE T.id_trt = @@@ID_TRT@@@ AND S.mois_paie = @@@PERIODE_PAIE@@@ GROUP BY S.numpac, S.mois_paie, S.debut_periode_recueil, S.fin_periode_recueil ORDER BY COUNT(paiezad) DESC ) WHERE rownum = 1 ) P ON P.mois_paie = R.mois_paie AND P.numpac = R.numpac AND (P.debut_periode_recueil IS NULL OR P.debut_periode_recueil = NVL(R.debut_periode_recueil, to_date(''19000101'',''yyyymmdd''))) AND (P.fin_periode_recueil IS NULL OR P.fin_periode_recueil = NVL(R.fin_periode_recueil, to_date(''19000102'',''yyyymmdd''))) JOIN dic_adm_contrat_histo H ON H.numpac = R.numpac AND H.pacmat = R.pacmat AND H.paiezad =R.paiezad AND H.za996 = ''W'' JOIN dic_adm_contrat C ON C.numpac= R.numpac AND C.pacmat= R.pacmat AND C.numcnt= H.numcnt AND C.dsdcn = R.entree JOIN dic_adm_contrat_situ CS ON CS.numpac = C.numpac AND CS.pacmat = C.pacmat AND CS.numcnt = C.numcnt AND CS.paiezad = C.current_paiezad JOIN gap_trt_liste_mat T ON T.numpac = R.numpac AND R.pacmat = T.pacmat WHERE (P.fin_periode_recueil IS NULL OR NVL(R.fin_periode_recueil,P.fin_periode_recueil) BETWEEN H.date_eff AND H.DATE_SORTIE_SIT_BO) AND T.id_trt = @@@ID_TRT@@@ AND NOT EXISTS (SELECT 1 FROM TGE_PERIODE_RECUEIL_PAIEZAD S WHERE S.paiezad = R.paiezad AND S.RETOUR_SUSPENSION >= S.sortie AND S.mois_paie =R.mois_paie AND S.numpac =T.numpac )'
'RD','PAI2_RETRO','1','SELECT R.pacmat, R.paiezad, C.numcnt, R.entree AS DEB_EMP, NVL(R.sortie, to_date(''31.12.2099'', ''dd.MM.yyyy'')) AS FIN_EMP, NVL(R.DEBUT_PERIODE_RECUEIL, to_date(''19000101'',''yyyymmdd'')) AS DEB_REC, NVL(R.FIN_PERIODE_RECUEIL, to_date(''19000102'',''yyyymmdd'')) AS FIN_REC, CS.CODE_CHRONO AS CODE_CHRONO FROM tge_periode_recueil_paiezad R JOIN ( SELECT numpac, mois_paie, debut_periode_recueil, fin_periode_recueil FROM ( SELECT S.numpac, S.mois_paie, S.debut_periode_recueil, S.fin_periode_recueil, COUNT(paiezad) AS nb_Dossier FROM ( SELECT NUMPAC, PACMAT FROM GAP_RETRO_MATRIC where periode_retro = @@@PERIODE_RETRO@@@ UNION SELECT NUMPAC, PACMAT FROM GAP_SELECTION_RETRO where periode_retro = @@@PERIODE_RETRO@@@ ) T JOIN gap_trt_liste_mat L ON L.numpac = T.numpac AND L.pacmat = L.pacmat JOIN tge_periode_recueil_paiezad S ON S.numpac = T.numpac AND S.pacmat = T.pacmat  JOIN TGE_MODIF_PACMAT_RETRO PR ON PR.NUMPAC = L.numpac AND PR.pacmat = L.pacmat AND Pr.Periode_Retro = @@@PERIODE_RETRO@@@ AND Pr.Table_Maj = ''PRD_PP_RETRO_INFOPAIE''  WHERE L.id_trt = @@@ID_TRT@@@ AND S.mois_paie = @@@PERIODE_RETRO@@@ GROUP BY S.numpac, S.mois_paie, S.debut_periode_recueil, S.fin_periode_recueil ORDER BY COUNT(paiezad) DESC ) WHERE rownum = 1 ) P ON P.mois_paie = R.mois_paie AND P.numpac = R.numpac AND ( P.debut_periode_recueil IS NULL OR P.debut_periode_recueil = NVL(R.debut_periode_recueil, to_date(''19000101'', ''yyyymmdd'')) ) AND ( P.fin_periode_recueil IS NULL OR P.fin_periode_recueil = NVL(R.fin_periode_recueil, to_date(''19000102'', ''yyyymmdd'')) ) JOIN dic_adm_contrat_histo H ON H.numpac = R.numpac AND H.pacmat = R.pacmat AND H.paiezad =R.paiezad AND H.za996 = ''W'' JOIN dic_adm_contrat C ON C.numpac = R.numpac AND C.pacmat= R.pacmat AND C.numcnt= H.numcnt AND C.dsdcn = R.entree JOIN dic_adm_contrat_situ CS ON CS.numpac = C.numpac AND CS.pacmat = C.pacmat AND CS.numcnt = C.numcnt AND CS.paiezad = C.current_paiezad JOIN gap_trt_liste_mat L ON L.numpac = R.numpac AND R.pacmat = L.pacmat JOIN ( SELECT NUMPAC, PACMAT FROM GAP_RETRO_MATRIC where periode_retro = @@@PERIODE_RETRO@@@ UNION SELECT NUMPAC, PACMAT FROM GAP_SELECTION_RETRO where periode_retro = @@@PERIODE_RETRO@@@ ) T ON T.numpac = R.numpac AND R.pacmat = T.pacmat  JOIN TGE_MODIF_PACMAT_RETRO PR ON PR.NUMPAC = L.numpac AND PR.pacmat = L.pacmat AND Pr.Periode_Retro = @@@PERIODE_RETRO@@@ AND Pr.Table_Maj = ''PRD_PP_RETRO_INFOPAIE''  WHERE ( P.fin_periode_recueil IS NULL OR NVL(R.fin_periode_recueil,P.fin_periode_recueil) BETWEEN H.date_eff AND H.DATE_SORTIE_SIT_BO ) AND L.id_trt = @@@ID_TRT@@@ AND NOT EXISTS ( SELECT 1 FROM TGE_PERIODE_RECUEIL_PAIEZAD S WHERE S.paiezad = R.paiezad AND S.RETOUR_SUSPENSION >= S.sortie AND S.mois_paie =R.mois_paie AND S.numpac =T.numpac )'
'RD','PAI3','1','SELECT R.pacmat, R.paiezad, C.numcnt, R.entree AS DEB_EMP, NVL(R.sortie, to_date(''31.12.2099'', ''dd.MM.yyyy'')) AS FIN_EMP, NVL(R.DEBUT_PERIODE_RECUEIL, P.DEBUT_PERIODE_RECUEIL) AS DEB_REC, NVL(R.FIN_PERIODE_RECUEIL, R.sortie) AS FIN_REC , A.CODE_CHRONO AS CODE_CHRONO FROM tge_periode_recueil_paiezad R JOIN (SELECT numpac, mois_paie, debut_periode_recueil, fin_periode_recueil FROM (SELECT S.numpac, S.mois_paie, S.debut_periode_recueil, S.fin_periode_recueil, COUNT(paiezad) AS nb_Dossier FROM gap_trt_liste_mat T JOIN tge_periode_recueil_paiezad S ON S.numpac = T.numpac AND S.pacmat = T.pacmat WHERE T.id_trt = @@@ID_TRT@@@ AND S.mois_paie = @@@PERIODE_PAIE@@@ GROUP BY S.numpac, S.mois_paie, S.debut_periode_recueil, S.fin_periode_recueil ORDER BY COUNT(paiezad) DESC ) WHERE rownum = 1 ) P ON P.mois_paie = R.mois_paie AND P.numpac = R.numpac AND ((P.debut_periode_recueil IS NULL OR P.debut_periode_recueil <> NVL(R.debut_periode_recueil, to_date(''19000101'',''yyyymmdd''))) OR (P.fin_periode_recueil IS NULL OR P.fin_periode_recueil <> NVL(R.fin_periode_recueil, to_date(''19000102'',''yyyymmdd'')))) JOIN dic_adm_contrat_histo H ON H.numpac = R.numpac AND H.pacmat = R.pacmat AND H.paiezad =R.paiezad AND H.za996 = ''W'' JOIN dic_adm_contrat C ON C.numpac= R.numpac AND C.pacmat= R.pacmat AND C.numcnt= H.numcnt AND C.dsdcn = R.entree JOIN gap_trt_liste_mat T ON T.numpac = R.numpac AND t.pacmat = R.pacmat JOIN situation_paie A ON A.numpac = R.numpac AND A.paiezad = R.paiezad AND A.PERIODEENCOURS = R.mois_paie WHERE (P.fin_periode_recueil IS NULL OR NVL(R.fin_periode_recueil,P.fin_periode_recueil) BETWEEN H.date_eff AND H.DATE_SORTIE_SIT_BO OR R.entree BETWEEN P.fin_periode_recueil AND R.fin_periode_paie) AND (NVL(R.sortie,to_date(''20991231'',''yyyymmdd''))>= R.debut_periode_paie OR A.RETRO_SORTIE = ''O'') AND T.id_trt = @@@ID_TRT@@@ AND EXISTS (SELECT 1 FROM TGE_PERIODE_RECUEIL_PAIEZAD S WHERE S.paiezad = R.paiezad AND S.RETOUR_SUSPENSION >= S.sortie AND S.mois_paie =R.mois_paie AND S.numpac =T.numpac )'
'RD','PAI3','2','SELECT R.pacmat, R.paiezad, C.numcnt, R.entree AS DEB_EMP, NVL(R.sortie, to_date(''31.12.2099'', ''dd.MM.yyyy'')) AS FIN_EMP, NVL(R.DEBUT_PERIODE_RECUEIL, to_date(''19000101'',''yyyymmdd'')) AS DEB_REC, NVL(R.FIN_PERIODE_RECUEIL, to_date(''19000102'',''yyyymmdd'')) AS FIN_REC , A.CODE_CHRONO AS CODE_CHRONO FROM tge_periode_recueil_paiezad R JOIN (SELECT numpac, mois_paie, debut_periode_recueil, fin_periode_recueil FROM (SELECT S.numpac, S.mois_paie, S.debut_periode_recueil, S.fin_periode_recueil, COUNT(paiezad) AS nb_Dossier FROM gap_trt_liste_mat T JOIN tge_periode_recueil_paiezad S ON S.numpac = T.numpac AND S.pacmat = T.pacmat WHERE T.id_trt = @@@ID_TRT@@@ AND S.mois_paie = @@@PERIODE_PAIE@@@ GROUP BY S.numpac, S.mois_paie, S.debut_periode_recueil, S.fin_periode_recueil ORDER BY COUNT(paiezad) DESC ) WHERE rownum = 1 ) P ON P.mois_paie = R.mois_paie AND P.numpac = R.numpac AND ((P.debut_periode_recueil IS NULL OR P.debut_periode_recueil <> NVL(R.debut_periode_recueil, to_date(''19000101'',''yyyymmdd''))) OR (P.fin_periode_recueil IS NULL OR P.fin_periode_recueil <> NVL(R.fin_periode_recueil, to_date(''19000102'',''yyyymmdd'')))) JOIN dic_adm_contrat_histo H ON H.numpac = R.numpac AND H.pacmat = R.pacmat AND H.paiezad =R.paiezad AND H.za996 = ''W'' JOIN dic_adm_contrat C ON C.numpac= R.numpac AND C.pacmat= R.pacmat AND C.numcnt= H.numcnt AND C.dsdcn = R.entree JOIN gap_trt_liste_mat T ON T.numpac = R.numpac AND t.pacmat = R.pacmat JOIN situation_paie A ON A.numpac = R.numpac AND A.paiezad = R.paiezad AND A.PERIODEENCOURS = R.mois_paie WHERE (P.fin_periode_recueil IS NULL OR NVL(R.fin_periode_recueil,P.fin_periode_recueil) BETWEEN H.date_eff AND H.DATE_SORTIE_SIT_BO OR R.entree BETWEEN P.fin_periode_recueil AND R.fin_periode_paie) AND (NVL(R.sortie,to_date(''20991231'',''yyyymmdd''))>= R.debut_periode_paie OR A.RETRO_SORTIE = ''O'') AND T.id_trt = @@@ID_TRT@@@ AND NOT EXISTS (SELECT 1 FROM TGE_PERIODE_RECUEIL_PAIEZAD S WHERE S.paiezad = R.paiezad AND S.RETOUR_SUSPENSION >= S.sortie AND S.mois_paie =R.mois_paie AND S.numpac =T.numpac ) AND NOT EXISTS (SELECT 1 FROM tge_periode_recueil_paiezad s WHERE s.paiezad = r.paiezad AND s.fin_periode_recueil >= r.sortie AND s.mois_paie < r.mois_paie AND s.numpac = t.numpac )'
'RD','PAI3_RETRO','1','SELECT R.pacmat, R.paiezad, C.numcnt, R.entree AS DEB_EMP, NVL(R.sortie, to_date(''31.12.2099'', ''dd.MM.yyyy'')) AS FIN_EMP, NVL(R.DEBUT_PERIODE_RECUEIL, P.DEBUT_PERIODE_RECUEIL) AS DEB_REC, NVL(R.FIN_PERIODE_RECUEIL, R.sortie) AS FIN_REC , A.CODE_CHRONO AS CODE_CHRONO FROM tge_periode_recueil_paiezad R JOIN ( SELECT numpac, mois_paie, debut_periode_recueil, fin_periode_recueil FROM ( SELECT S.numpac, S.mois_paie, S.debut_periode_recueil, S.fin_periode_recueil, COUNT(paiezad) AS nb_Dossier FROM ( SELECT NUMPAC, PACMAT FROM GAP_RETRO_MATRIC where periode_retro = @@@PERIODE_RETRO@@@ UNION SELECT NUMPAC, PACMAT FROM GAP_SELECTION_RETRO where periode_retro = @@@PERIODE_RETRO@@@ ) T JOIN gap_trt_liste_mat L ON L.numpac = T.numpac AND L.pacmat = L.pacmat JOIN tge_periode_recueil_paiezad S ON S.numpac = T.numpac AND S.pacmat = T.pacmat  JOIN TGE_MODIF_PACMAT_RETRO PR ON PR.NUMPAC = L.numpac AND PR.pacmat = L.pacmat AND Pr.Periode_Retro = @@@PERIODE_RETRO@@@ AND Pr.Table_Maj = ''PRD_PP_RETRO_INFOPAIE'' WHERE L.id_trt = @@@ID_TRT@@@ AND S.mois_paie = @@@PERIODE_RETRO@@@ GROUP BY S.numpac, S.mois_paie, S.debut_periode_recueil, S.fin_periode_recueil ORDER BY s.mois_paie, COUNT(paiezad) DESC ) WHERE rownum = 1 ) P ON P.mois_paie = R.mois_paie AND P.numpac = R.numpac AND ( ( P.debut_periode_recueil IS NULL OR P.debut_periode_recueil <> NVL(R.debut_periode_recueil, to_date( ''19000101'',''yyyymmdd'')) ) OR ( P.fin_periode_recueil IS NULL OR P.fin_periode_recueil <> NVL(R.fin_periode_recueil, to_date(''19000102'', ''yyyymmdd'')) ) ) JOIN dic_adm_contrat_histo H ON H.numpac = R.numpac AND H.pacmat = R.pacmat AND H.paiezad =R.paiezad AND H.za996 = ''W'' JOIN dic_adm_contrat C ON C.numpac = R.numpac AND C.pacmat= R.pacmat AND C.numcnt= H.numcnt AND C.dsdcn = R.entree JOIN gap_trt_liste_mat L ON L.numpac = R.numpac AND R.pacmat = L.pacmat JOIN ( SELECT NUMPAC, PACMAT FROM GAP_RETRO_MATRIC where periode_retro = @@@PERIODE_RETRO@@@ UNION SELECT NUMPAC, PACMAT FROM GAP_SELECTION_RETRO where periode_retro = @@@PERIODE_RETRO@@@ ) T ON T.numpac = R.numpac AND t.pacmat = R.pacmat JOIN situation_paie A ON A.numpac = R.numpac AND A.paiezad = R.paiezad AND A.PERIODEENCOURS = R.mois_paie  JOIN TGE_MODIF_PACMAT_RETRO PR ON PR.NUMPAC = L.numpac AND PR.pacmat = L.pacmat AND Pr.Periode_Retro = @@@PERIODE_RETRO@@@ AND Pr.Table_Maj = ''PRD_PP_RETRO_INFOPAIE'' WHERE ( P.fin_periode_recueil IS NULL OR NVL(R.fin_periode_recueil,P.fin_periode_recueil) BETWEEN H.date_eff AND H.DATE_SORTIE_SIT_BO OR R.entree BETWEEN P.fin_periode_recueil AND R.fin_periode_paie ) AND ( NVL(R.sortie,to_date(''20991231'',''yyyymmdd''))>= R.debut_periode_paie OR A.RETRO_SORTIE = ''O'' ) AND L.id_trt = @@@ID_TRT@@@ AND EXISTS ( SELECT 1 FROM TGE_PERIODE_RECUEIL_PAIEZAD S WHERE S.paiezad = R.paiezad AND S.RETOUR_SUSPENSION >= S.sortie AND S.mois_paie =R.mois_paie AND S.numpac =T.numpac )'
'RD','PAI3_RETRO','2','SELECT R.pacmat, R.paiezad, C.numcnt, R.entree AS DEB_EMP, NVL(R.sortie, to_date(''31.12.2099'', ''dd.MM.yyyy'')) AS FIN_EMP, NVL(R.DEBUT_PERIODE_RECUEIL, to_date(''19000101'',''yyyymmdd'')) AS DEB_REC, NVL(R.FIN_PERIODE_RECUEIL, to_date(''19000102'',''yyyymmdd'')) AS FIN_REC , A.CODE_CHRONO AS CODE_CHRONO FROM tge_periode_recueil_paiezad R JOIN ( SELECT numpac, mois_paie, debut_periode_recueil, fin_periode_recueil FROM ( SELECT S.numpac, S.mois_paie, S.debut_periode_recueil, S.fin_periode_recueil, COUNT(paiezad) AS nb_Dossier FROM ( SELECT NUMPAC, PACMAT FROM GAP_RETRO_MATRIC where periode_retro = @@@PERIODE_RETRO@@@ UNION SELECT NUMPAC, PACMAT FROM GAP_SELECTION_RETRO where periode_retro = @@@PERIODE_RETRO@@@ ) T JOIN gap_trt_liste_mat L ON L.numpac = T.numpac AND L.pacmat = L.pacmat JOIN tge_periode_recueil_paiezad S ON S.numpac = T.numpac AND S.pacmat = T.pacmat  JOIN TGE_MODIF_PACMAT_RETRO PR ON PR.NUMPAC = L.numpac AND PR.pacmat = L.pacmat AND Pr.Periode_Retro = @@@PERIODE_RETRO@@@ AND Pr.Table_Maj = ''PRD_PP_RETRO_INFOPAIE'' WHERE L.id_trt = @@@ID_TRT@@@ AND S.mois_paie = @@@PERIODE_RETRO@@@ GROUP BY S.numpac, S.mois_paie, S.debut_periode_recueil, S.fin_periode_recueil ORDER BY COUNT(paiezad) DESC ) WHERE rownum = 1 ) P ON P.mois_paie = R.mois_paie AND P.numpac = R.numpac AND ( ( P.debut_periode_recueil IS NULL OR P.debut_periode_recueil <> NVL(R.debut_periode_recueil, to_date( ''19000101'',''yyyymmdd'')) ) OR ( P.fin_periode_recueil IS NULL OR P.fin_periode_recueil <> NVL(R.fin_periode_recueil, to_date(''19000102'', ''yyyymmdd'')) ) ) JOIN dic_adm_contrat_histo H ON H.numpac = R.numpac AND H.pacmat = R.pacmat AND H.paiezad =R.paiezad AND H.za996 = ''W'' JOIN dic_adm_contrat C ON C.numpac = R.numpac AND C.pacmat= R.pacmat AND C.numcnt= H.numcnt AND C.dsdcn = R.entree JOIN gap_trt_liste_mat L ON L.numpac = R.numpac AND R.pacmat = L.pacmat JOIN ( SELECT NUMPAC, PACMAT FROM GAP_RETRO_MATRIC where periode_retro = @@@PERIODE_RETRO@@@ UNION SELECT NUMPAC, PACMAT FROM GAP_SELECTION_RETRO where periode_retro = @@@PERIODE_RETRO@@@ ) T ON T.numpac = R.numpac AND t.pacmat = R.pacmat JOIN situation_paie A ON A.numpac = R.numpac AND A.paiezad = R.paiezad AND A.PERIODEENCOURS = R.mois_paie  JOIN TGE_MODIF_PACMAT_RETRO PR ON PR.NUMPAC = L.numpac AND PR.pacmat = L.pacmat AND Pr.Periode_Retro = @@@PERIODE_RETRO@@@ AND Pr.Table_Maj = ''PRD_PP_RETRO_INFOPAIE'' WHERE ( P.fin_periode_recueil IS NULL OR NVL(R.fin_periode_recueil,P.fin_periode_recueil) BETWEEN H.date_eff AND H.DATE_SORTIE_SIT_BO OR R.entree BETWEEN P.fin_periode_recueil AND R.fin_periode_paie ) AND ( NVL(R.sortie,to_date(''20991231'',''yyyymmdd''))>= R.debut_periode_paie OR A.RETRO_SORTIE = ''O'' ) AND L.id_trt = @@@ID_TRT@@@ AND NOT EXISTS ( SELECT 1 FROM TGE_PERIODE_RECUEIL_PAIEZAD S WHERE S.paiezad = R.paiezad AND S.RETOUR_SUSPENSION >= S.sortie AND S.mois_paie =R.mois_paie AND S.numpac =T.numpac ) AND NOT EXISTS ( SELECT 1 FROM tge_periode_recueil_paiezad s WHERE s.paiezad = r.paiezad AND s.fin_periode_recueil >= r.sortie AND s.mois_paie < r.mois_paie AND s.numpac = t.numpac )'
##
TGE_REF_ENVOI_PAI
==
DELETE FROM TGE_REF_ENVOI_PAI
##
TGE_REF_ENVOI_PAI (ORIGINE,CODE_REQ,ORDRE_REQ,REQUETE)
'RD','PAI','1','SELECT G.ID_TRT, T.NUMPAC, ''NORMAL'' AS TYPE_ENVOIE, T.MOIS_PAIE as PERIODE_PAIE, T.MOIS_PAIE as PERIODE_RETRO, T.PAIEZAD, T.PACMAT, T.DEBUT_PERIODE_PAIE, T.FIN_PERIODE_PAIE, T.ENTREE, T.SORTIE, T.DEBUT_PERIODE_RECUEIL, T.FIN_PERIODE_RECUEIL, CASE WHEN ( (T.ENTREE NOT BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE) AND (T.SORTIE NOT BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE) ) THEN ''PAI2'' ELSE ''PAI3'' END AS TYPEPAI , ( SELECT COUNT(*) FROM DIC_ADM_CONTRAT DAC WHERE T.NUMPAC =DAC.NUMPAC AND T.PACMAT =DAC.PACMAT AND DAC.CURRENT_PAIEZAD=T.PAIEZAD AND ( T.DEBUT_PERIODE_PAIE BETWEEN DSDCN AND NVL(DSFCN,TO_DATE(''31.12.2099'',''DD.MM.YYYY'')) OR T.FIN_PERIODE_PAIE BETWEEN DSDCN AND NVL(DSFCN,TO_DATE(''31.12.2099'',''DD.MM.YYYY'')) ) ) AS NB_CONTRAT , ( SELECT CODE_CHRONO FROM DIC_ADM_CONTRAT_SITU DACS WHERE T.NUMPAC =DACS.NUMPAC AND T.PACMAT =DACS.PACMAT AND DACS.PAIEZAD=T.PAIEZAD AND (T.DEBUT_PERIODE_PAIE BETWEEN DSDSC AND NVL(DSFSC,TO_DATE(''31.12.2099'',''DD.MM.YYYY'')) OR T.FIN_PERIODE_PAIE BETWEEN DSDSC AND NVL(DSFSC,TO_DATE(''31.12.2099'',''DD.MM.YYYY'')) ) ) AS CODE_CHRONO FROM GAP_TRT_LISTE_MAT G , TGE_PERIODE_RECUEIL_PAIEZAD T WHERE G.NUMPAC = ? AND T.numpac = G.NUMPAC AND T.PACMAT =G.PACMAT AND G.ID_TRT = ? AND t.mois_paie = ? '
'RD','PAI_RETRO','1','SELECT G.ID_TRT, T.NUMPAC, ''RETRO'' AS TYPE_ENVOIE, ? AS PERIODE_PAIE, PR.PERIODE_RETRO AS PERIODE_RETRO, T.PAIEZAD, T.PACMAT, T.DEBUT_PERIODE_PAIE, T.FIN_PERIODE_PAIE, T.ENTREE, T.SORTIE, T.DEBUT_PERIODE_RECUEIL, T.FIN_PERIODE_RECUEIL, CASE WHEN ( ( T.ENTREE NOT BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) AND ( T.SORTIE NOT BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) ) THEN ''PAI2'' ELSE ''PAI3'' END AS TYPEPAI , ( SELECT COUNT(*) FROM DIC_ADM_CONTRAT DAC WHERE T.NUMPAC =DAC.NUMPAC AND T.PACMAT =DAC.PACMAT AND DAC.CURRENT_PAIEZAD=T.PAIEZAD AND ( T.DEBUT_PERIODE_PAIE BETWEEN DSDCN AND NVL(DSFCN,TO_DATE(''31.12.2099'', ''DD.MM.YYYY'')) OR T.FIN_PERIODE_PAIE BETWEEN DSDCN AND NVL(DSFCN,TO_DATE(''31.12.2099'', ''DD.MM.YYYY'')) ) ) AS NB_CONTRAT , ( SELECT CODE_CHRONO FROM DIC_ADM_CONTRAT_SITU DACS WHERE T.NUMPAC =DACS.NUMPAC AND T.PACMAT =DACS.PACMAT AND DACS.PAIEZAD=T.PAIEZAD AND ( T.DEBUT_PERIODE_PAIE BETWEEN DSDSC AND NVL(DSFSC,TO_DATE(''31.12.2099'', ''DD.MM.YYYY'')) OR T.FIN_PERIODE_PAIE BETWEEN DSDSC AND NVL(DSFSC,TO_DATE(''31.12.2099'', ''DD.MM.YYYY'')) ) ) AS CODE_CHRONO FROM GAP_TRT_LISTE_MAT G , TGE_PERIODE_RECUEIL_PAIEZAD T , TGE_MODIF_PACMAT_RETRO PR WHERE T.NUMPAC =? AND T.numpac = G.NUMPAC AND T.PACMAT = G.PACMAT AND T.MOIS_PAIE = PR.PERIODE_RETRO AND PR.PERIODE_RETRO >= ? AND PR.NUMPAC = G.NUMPAC AND PR.Pacmat = G.PACMAT AND G.ID_TRT = ? AND PR.TABLE_MAJ = ''PRD_PP_RETRO_INFOPAIE'' AND ( G.NUMPAC,G.PACMAT,PR.PERIODE_RETRO ) IN ( SELECT NUMPAC, PACMAT, PERIODE_RETRO FROM GAP_RETRO_MATRIC UNION ALL SELECT NUMPAC, PACMAT, PERIODE_RETRO FROM GAP_SELECTION_RETRO ) '
##
TGE_REF_ENVOI_PAI
==
DELETE FROM TGE_REF_ENVOI_PAI
##
TGE_REF_ENVOI_PAI (ORIGINE,CODE_REQ,ORDRE_REQ,REQUETE)
'RD','PAI','1','SELECT G.ID_TRT, T.NUMPAC, ''NORMAL'' AS TYPE_ENVOIE, T.MOIS_PAIE as PERIODE_PAIE, T.MOIS_PAIE as PERIODE_RETRO, T.PAIEZAD, T.PACMAT, T.DEBUT_PERIODE_PAIE, T.FIN_PERIODE_PAIE, T.ENTREE, T.SORTIE, T.DEBUT_PERIODE_RECUEIL, T.FIN_PERIODE_RECUEIL, CASE WHEN ( (T.ENTREE NOT BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE) AND (T.SORTIE NOT BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE) ) THEN ''PAI2'' ELSE ''PAI3'' END AS TYPEPAI , ( SELECT COUNT(*) FROM DIC_ADM_CONTRAT DAC WHERE T.NUMPAC =DAC.NUMPAC AND T.PACMAT =DAC.PACMAT AND DAC.CURRENT_PAIEZAD=T.PAIEZAD AND ( T.DEBUT_PERIODE_PAIE BETWEEN DSDCN AND NVL(DSFCN,TO_DATE(''31.12.2099'',''DD.MM.YYYY'')) OR T.FIN_PERIODE_PAIE BETWEEN DSDCN AND NVL(DSFCN,TO_DATE(''31.12.2099'',''DD.MM.YYYY'')) OR DSDCN BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) ) AS NB_CONTRAT , ( SELECT CODE_CHRONO FROM DIC_ADM_CONTRAT_SITU DACS WHERE T.NUMPAC =DACS.NUMPAC AND T.PACMAT =DACS.PACMAT AND DACS.PAIEZAD=T.PAIEZAD AND (T.DEBUT_PERIODE_PAIE BETWEEN DSDSC AND NVL(DSFSC,TO_DATE(''31.12.2099'',''DD.MM.YYYY'')) OR T.FIN_PERIODE_PAIE BETWEEN DSDSC AND NVL(DSFSC,TO_DATE(''31.12.2099'',''DD.MM.YYYY'')) OR DSDSC BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) ) AS CODE_CHRONO FROM GAP_TRT_LISTE_MAT G , TGE_PERIODE_RECUEIL_PAIEZAD T WHERE G.NUMPAC = ? AND T.numpac = G.NUMPAC AND T.PACMAT =G.PACMAT AND G.ID_TRT = ? AND t.mois_paie = ? '
'RD','PAI_RETRO','1','SELECT G.ID_TRT, T.NUMPAC, ''RETRO'' AS TYPE_ENVOIE, ? AS PERIODE_PAIE, PR.PERIODE_RETRO AS PERIODE_RETRO, T.PAIEZAD, T.PACMAT, T.DEBUT_PERIODE_PAIE, T.FIN_PERIODE_PAIE, T.ENTREE, T.SORTIE, T.DEBUT_PERIODE_RECUEIL, T.FIN_PERIODE_RECUEIL, CASE WHEN ( ( T.ENTREE NOT BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) AND ( T.SORTIE NOT BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) ) THEN ''PAI2'' ELSE ''PAI3'' END AS TYPEPAI , ( SELECT COUNT(*) FROM DIC_ADM_CONTRAT DAC WHERE T.NUMPAC =DAC.NUMPAC AND T.PACMAT =DAC.PACMAT AND DAC.CURRENT_PAIEZAD=T.PAIEZAD AND ( T.DEBUT_PERIODE_PAIE BETWEEN DSDCN AND NVL(DSFCN,TO_DATE(''31.12.2099'', ''DD.MM.YYYY'')) OR T.FIN_PERIODE_PAIE BETWEEN DSDCN AND NVL(DSFCN,TO_DATE(''31.12.2099'', ''DD.MM.YYYY'')) OR DSDCN BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) ) AS NB_CONTRAT , ( SELECT CODE_CHRONO FROM DIC_ADM_CONTRAT_SITU DACS WHERE T.NUMPAC =DACS.NUMPAC AND T.PACMAT =DACS.PACMAT AND DACS.PAIEZAD=T.PAIEZAD AND ( T.DEBUT_PERIODE_PAIE BETWEEN DSDSC AND NVL(DSFSC,TO_DATE(''31.12.2099'', ''DD.MM.YYYY'')) OR T.FIN_PERIODE_PAIE BETWEEN DSDSC AND NVL(DSFSC,TO_DATE(''31.12.2099'', ''DD.MM.YYYY'')) OR DSDSC BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) ) AS CODE_CHRONO FROM GAP_TRT_LISTE_MAT G , TGE_PERIODE_RECUEIL_PAIEZAD T , TGE_MODIF_PACMAT_RETRO PR WHERE T.NUMPAC =? AND T.numpac = G.NUMPAC AND T.PACMAT = G.PACMAT AND T.MOIS_PAIE = PR.PERIODE_RETRO AND PR.PERIODE_RETRO >= ? AND PR.NUMPAC = G.NUMPAC AND PR.Pacmat = G.PACMAT AND G.ID_TRT = ? AND PR.TABLE_MAJ = ''PRD_PP_RETRO_INFOPAIE'' AND ( G.NUMPAC,G.PACMAT,PR.PERIODE_RETRO ) IN ( SELECT NUMPAC, PACMAT, PERIODE_RETRO FROM GAP_RETRO_MATRIC UNION ALL SELECT NUMPAC, PACMAT, PERIODE_RETRO FROM GAP_SELECTION_RETRO ) '
##
TGE_REF_ENVOI_PAI
==
DELETE FROM TGE_REF_ENVOI_PAI
##
TGE_REF_ENVOI_PAI (ORIGINE,CODE_REQ,ORDRE_REQ,REQUETE)
'RD','PAI','1','SELECT G.ID_TRT, T.NUMPAC, ''NORMAL'' AS TYPE_ENVOIE, T.MOIS_PAIE as PERIODE_PAIE, T.MOIS_PAIE as PERIODE_RETRO, T.PAIEZAD, T.PACMAT, T.DEBUT_PERIODE_PAIE, T.FIN_PERIODE_PAIE, T.ENTREE, T.SORTIE, NVL(T.DEBUT_PERIODE_RECUEIL,T.DEBUT_PERIODE_RECUEIL_LTP), NVL(T.FIN_PERIODE_RECUEIL,T.FIN_PERIODE_RECUEIL_LTP), CASE WHEN ( (T.ENTREE NOT BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE) AND (T.SORTIE NOT BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE) ) THEN ''PAI2'' ELSE ''PAI3'' END AS TYPEPAI , ( SELECT COUNT(*) FROM DIC_ADM_CONTRAT DAC WHERE T.NUMPAC =DAC.NUMPAC AND T.PACMAT =DAC.PACMAT AND DAC.CURRENT_PAIEZAD=T.PAIEZAD AND ( T.DEBUT_PERIODE_PAIE BETWEEN DSDCN AND NVL(DSFCN,TO_DATE(''31.12.2099'',''DD.MM.YYYY'')) OR T.FIN_PERIODE_PAIE BETWEEN DSDCN AND NVL(DSFCN,TO_DATE(''31.12.2099'',''DD.MM.YYYY'')) OR DSDCN BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) ) AS NB_CONTRAT , ( SELECT CODE_CHRONO FROM DIC_ADM_CONTRAT_SITU DACS WHERE T.NUMPAC =DACS.NUMPAC AND T.PACMAT =DACS.PACMAT AND DACS.PAIEZAD=T.PAIEZAD AND (T.DEBUT_PERIODE_PAIE BETWEEN DSDSC AND NVL(DSFSC,TO_DATE(''31.12.2099'',''DD.MM.YYYY'')) OR T.FIN_PERIODE_PAIE BETWEEN DSDSC AND NVL(DSFSC,TO_DATE(''31.12.2099'',''DD.MM.YYYY'')) OR DSDSC BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) ) AS CODE_CHRONO FROM GAP_TRT_LISTE_MAT G , TGE_PERIODE_RECUEIL_PAIEZAD T WHERE G.NUMPAC = ? AND T.numpac = G.NUMPAC AND T.PACMAT =G.PACMAT AND G.ID_TRT = ? AND t.mois_paie = ? '
'RD','PAI_RETRO','1','SELECT G.ID_TRT, T.NUMPAC, ''RETRO'' AS TYPE_ENVOIE, ? AS PERIODE_PAIE, PR.PERIODE_RETRO AS PERIODE_RETRO, T.PAIEZAD, T.PACMAT, T.DEBUT_PERIODE_PAIE, T.FIN_PERIODE_PAIE, T.ENTREE, T.SORTIE, NVL(T.DEBUT_PERIODE_RECUEIL,T.DEBUT_PERIODE_RECUEIL_LTP), NVL(T.FIN_PERIODE_RECUEIL,T.FIN_PERIODE_RECUEIL_LTP), CASE WHEN ( ( T.ENTREE NOT BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) AND ( T.SORTIE NOT BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) ) THEN ''PAI2'' ELSE ''PAI3'' END AS TYPEPAI , ( SELECT COUNT(*) FROM DIC_ADM_CONTRAT DAC WHERE T.NUMPAC =DAC.NUMPAC AND T.PACMAT =DAC.PACMAT AND DAC.CURRENT_PAIEZAD=T.PAIEZAD AND ( T.DEBUT_PERIODE_PAIE BETWEEN DSDCN AND NVL(DSFCN,TO_DATE(''31.12.2099'', ''DD.MM.YYYY'')) OR T.FIN_PERIODE_PAIE BETWEEN DSDCN AND NVL(DSFCN,TO_DATE(''31.12.2099'', ''DD.MM.YYYY'')) OR DSDCN BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) ) AS NB_CONTRAT , ( SELECT CODE_CHRONO FROM DIC_ADM_CONTRAT_SITU DACS WHERE T.NUMPAC =DACS.NUMPAC AND T.PACMAT =DACS.PACMAT AND DACS.PAIEZAD=T.PAIEZAD AND ( T.DEBUT_PERIODE_PAIE BETWEEN DSDSC AND NVL(DSFSC,TO_DATE(''31.12.2099'', ''DD.MM.YYYY'')) OR T.FIN_PERIODE_PAIE BETWEEN DSDSC AND NVL(DSFSC,TO_DATE(''31.12.2099'', ''DD.MM.YYYY'')) OR DSDSC BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) ) AS CODE_CHRONO FROM GAP_TRT_LISTE_MAT G , TGE_PERIODE_RECUEIL_PAIEZAD T , TGE_MODIF_PACMAT_RETRO PR WHERE T.NUMPAC =? AND T.numpac = G.NUMPAC AND T.PACMAT = G.PACMAT AND T.MOIS_PAIE = PR.PERIODE_RETRO AND PR.PERIODE_RETRO >= ? AND PR.NUMPAC = G.NUMPAC AND PR.Pacmat = G.PACMAT AND G.ID_TRT = ? AND PR.TABLE_MAJ = ''PRD_PP_RETRO_INFOPAIE'' AND ( G.NUMPAC,G.PACMAT,PR.PERIODE_RETRO ) IN ( SELECT NUMPAC, PACMAT, PERIODE_RETRO FROM GAP_RETRO_MATRIC UNION ALL SELECT NUMPAC, PACMAT, PERIODE_RETRO FROM GAP_SELECTION_RETRO ) '
##
TGE_REF_ENVOI_PAI
==
DELETE FROM TGE_REF_ENVOI_PAI where ORIGINE = 'RD' and CODE_REQ in ('PAI','PAI_RETRO')
##
TGE_REF_ENVOI_PAI (ORIGINE,CODE_REQ,ORDRE_REQ,REQUETE)
'RD','PAI','1','SELECT G.ID_TRT, T.NUMPAC, ''NORMAL'' AS TYPE_ENVOIE, T.MOIS_PAIE as PERIODE_PAIE, T.MOIS_PAIE as PERIODE_RETRO, T.PAIEZAD, T.PACMAT, T.DEBUT_PERIODE_PAIE, T.FIN_PERIODE_PAIE, T.ENTREE, T.SORTIE, NVL(T.DEBUT_PERIODE_RECUEIL,T.DEBUT_PERIODE_RECUEIL_LTP), NVL(T.FIN_PERIODE_RECUEIL,T.FIN_PERIODE_RECUEIL_LTP), CASE WHEN ( (T.ENTREE NOT BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE) AND (T.SORTIE NOT BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE) ) THEN ''PAI2'' ELSE ''PAI3'' END AS TYPEPAI , ( SELECT COUNT(*) FROM DIC_ADM_CONTRAT DAC WHERE T.NUMPAC =DAC.NUMPAC AND T.PACMAT =DAC.PACMAT AND DAC.CURRENT_PAIEZAD=T.PAIEZAD AND ( T.DEBUT_PERIODE_PAIE BETWEEN DSDCN AND NVL(DSFCN,TO_DATE(''31.12.2099'',''DD.MM.YYYY'')) OR T.FIN_PERIODE_PAIE BETWEEN DSDCN AND NVL(DSFCN,TO_DATE(''31.12.2099'',''DD.MM.YYYY'')) OR DSDCN BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) ) AS NB_CONTRAT , ( SELECT CODE_CHRONO FROM DIC_ADM_CONTRAT_SITU DACS WHERE T.NUMPAC =DACS.NUMPAC AND T.PACMAT =DACS.PACMAT AND DACS.PAIEZAD=T.PAIEZAD AND (T.DEBUT_PERIODE_PAIE BETWEEN DSDSC AND NVL(DSFSC,TO_DATE(''31.12.2099'',''DD.MM.YYYY'')) OR T.FIN_PERIODE_PAIE BETWEEN DSDSC AND NVL(DSFSC,TO_DATE(''31.12.2099'',''DD.MM.YYYY'')) OR DSDSC BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) ) AS CODE_CHRONO FROM GAP_TRT_LISTE_MAT G , TGE_PERIODE_RECUEIL_PAIEZAD T INNER JOIN dic_adm_contrat_histo H ON H.numpac   = T.numpac AND H.pacmat  = T.pacmat AND H.paiezad = T.paiezad AND H.za996 = ''W'' WHERE G.NUMPAC = ? AND T.numpac = G.NUMPAC AND T.PACMAT =G.PACMAT AND G.ID_TRT = ? AND t.mois_paie = ? '
'RD','PAI_RETRO','1','SELECT G.ID_TRT, T.NUMPAC, ''RETRO'' AS TYPE_ENVOIE, ? AS PERIODE_PAIE, PR.PERIODE_RETRO AS PERIODE_RETRO, T.PAIEZAD, T.PACMAT, T.DEBUT_PERIODE_PAIE, T.FIN_PERIODE_PAIE, T.ENTREE, T.SORTIE, NVL(T.DEBUT_PERIODE_RECUEIL,T.DEBUT_PERIODE_RECUEIL_LTP), NVL(T.FIN_PERIODE_RECUEIL,T.FIN_PERIODE_RECUEIL_LTP), CASE WHEN ( ( T.ENTREE NOT BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) AND ( T.SORTIE NOT BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) ) THEN ''PAI2'' ELSE ''PAI3'' END AS TYPEPAI , ( SELECT COUNT(*) FROM DIC_ADM_CONTRAT DAC WHERE T.NUMPAC =DAC.NUMPAC AND T.PACMAT =DAC.PACMAT AND DAC.CURRENT_PAIEZAD=T.PAIEZAD AND ( T.DEBUT_PERIODE_PAIE BETWEEN DSDCN AND NVL(DSFCN,TO_DATE(''31.12.2099'', ''DD.MM.YYYY'')) OR T.FIN_PERIODE_PAIE BETWEEN DSDCN AND NVL(DSFCN,TO_DATE(''31.12.2099'', ''DD.MM.YYYY'')) OR DSDCN BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) ) AS NB_CONTRAT , ( SELECT CODE_CHRONO FROM DIC_ADM_CONTRAT_SITU DACS WHERE T.NUMPAC =DACS.NUMPAC AND T.PACMAT =DACS.PACMAT AND DACS.PAIEZAD=T.PAIEZAD AND ( T.DEBUT_PERIODE_PAIE BETWEEN DSDSC AND NVL(DSFSC,TO_DATE(''31.12.2099'', ''DD.MM.YYYY'')) OR T.FIN_PERIODE_PAIE BETWEEN DSDSC AND NVL(DSFSC,TO_DATE(''31.12.2099'', ''DD.MM.YYYY'')) OR DSDSC BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) ) AS CODE_CHRONO FROM GAP_TRT_LISTE_MAT G , TGE_PERIODE_RECUEIL_PAIEZAD T , TGE_MODIF_PACMAT_RETRO PR, DIC_ADM_CONTRAT_HISTO H WHERE T.NUMPAC =? AND T.numpac = G.NUMPAC AND T.PACMAT = G.PACMAT AND T.MOIS_PAIE = PR.PERIODE_RETRO AND PR.PERIODE_RETRO >= ? AND PR.NUMPAC = G.NUMPAC AND PR.Pacmat = G.PACMAT AND G.ID_TRT = ? AND PR.TABLE_MAJ = ''PRD_PP_RETRO_INFOPAIE'' AND ( G.NUMPAC,G.PACMAT,PR.PERIODE_RETRO ) IN ( SELECT NUMPAC, PACMAT, PERIODE_RETRO FROM GAP_RETRO_MATRIC UNION ALL SELECT NUMPAC, PACMAT, PERIODE_RETRO FROM GAP_SELECTION_RETRO ) and H.NUMPAC   = T.NUMPAC AND H.PACMAT  = T.PACMAT AND H.PAIEZAD = T.PAIEZAD AND H.ZA996 = ''W'' '
##
TGE_REF_ENVOI_PAI
==
DELETE FROM TGE_REF_ENVOI_PAI where ORIGINE = 'RD' and CODE_REQ in ('PAI','PAI_RETRO')
##
TGE_REF_ENVOI_PAI (ORIGINE,CODE_REQ,ORDRE_REQ,REQUETE)
'RD','PAI','1','SELECT G.ID_TRT, T.NUMPAC, ''NORMAL'' AS TYPE_ENVOIE, T.MOIS_PAIE as PERIODE_PAIE, T.MOIS_PAIE as PERIODE_RETRO, T.PAIEZAD, T.PACMAT, T.DEBUT_PERIODE_PAIE, T.FIN_PERIODE_PAIE, T.ENTREE, T.SORTIE, NVL(T.DEBUT_PERIODE_RECUEIL,T.DEBUT_PERIODE_RECUEIL_LTP) AS DEBUT_PERIODE_RECUEIL, NVL(T.FIN_PERIODE_RECUEIL,T.FIN_PERIODE_RECUEIL_LTP) AS FIN_PERIODE_RECUEIL, CASE WHEN ( (T.ENTREE NOT BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE) AND (T.SORTIE NOT BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE) ) THEN ''PAI2'' ELSE ''PAI3'' END AS TYPEPAI , ( SELECT COUNT(*) FROM DIC_ADM_CONTRAT DAC WHERE T.NUMPAC =DAC.NUMPAC AND T.PACMAT =DAC.PACMAT AND DAC.CURRENT_PAIEZAD=T.PAIEZAD AND ( T.DEBUT_PERIODE_PAIE BETWEEN DSDCN AND NVL(DSFCN,TO_DATE(''31.12.2099'',''DD.MM.YYYY'')) OR T.FIN_PERIODE_PAIE BETWEEN DSDCN AND NVL(DSFCN,TO_DATE(''31.12.2099'',''DD.MM.YYYY'')) OR DSDCN BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) ) AS NB_CONTRAT , ( SELECT CODE_CHRONO FROM DIC_ADM_CONTRAT_SITU DACS WHERE T.NUMPAC =DACS.NUMPAC AND T.PACMAT =DACS.PACMAT AND DACS.PAIEZAD=T.PAIEZAD AND (T.DEBUT_PERIODE_PAIE BETWEEN DSDSC AND NVL(DSFSC,TO_DATE(''31.12.2099'',''DD.MM.YYYY'')) OR T.FIN_PERIODE_PAIE BETWEEN DSDSC AND NVL(DSFSC,TO_DATE(''31.12.2099'',''DD.MM.YYYY'')) OR DSDSC BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) ) AS CODE_CHRONO FROM GAP_TRT_LISTE_MAT G , TGE_PERIODE_RECUEIL_PAIEZAD T INNER JOIN dic_adm_contrat_histo H ON H.numpac   = T.numpac AND H.pacmat  = T.pacmat AND H.paiezad = T.paiezad AND H.za996 = ''W'' WHERE G.NUMPAC = ? AND T.numpac = G.NUMPAC AND T.PACMAT =G.PACMAT AND G.ID_TRT = ? AND t.mois_paie = ? '
'RD','PAI_RETRO','1','SELECT G.ID_TRT, T.NUMPAC, ''RETRO'' AS TYPE_ENVOIE, ? AS PERIODE_PAIE, PR.PERIODE_RETRO AS PERIODE_RETRO, T.PAIEZAD, T.PACMAT, T.DEBUT_PERIODE_PAIE, T.FIN_PERIODE_PAIE, T.ENTREE, T.SORTIE, NVL(T.DEBUT_PERIODE_RECUEIL,T.DEBUT_PERIODE_RECUEIL_LTP) AS DEBUT_PERIODE_RECUEIL, NVL(T.FIN_PERIODE_RECUEIL,T.FIN_PERIODE_RECUEIL_LTP) AS FIN_PERIODE_RECUEIL, CASE WHEN ( ( T.ENTREE NOT BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) AND ( T.SORTIE NOT BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) ) THEN ''PAI2'' ELSE ''PAI3'' END AS TYPEPAI , ( SELECT COUNT(*) FROM DIC_ADM_CONTRAT DAC WHERE T.NUMPAC =DAC.NUMPAC AND T.PACMAT =DAC.PACMAT AND DAC.CURRENT_PAIEZAD=T.PAIEZAD AND ( T.DEBUT_PERIODE_PAIE BETWEEN DSDCN AND NVL(DSFCN,TO_DATE(''31.12.2099'', ''DD.MM.YYYY'')) OR T.FIN_PERIODE_PAIE BETWEEN DSDCN AND NVL(DSFCN,TO_DATE(''31.12.2099'', ''DD.MM.YYYY'')) OR DSDCN BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) ) AS NB_CONTRAT , ( SELECT CODE_CHRONO FROM DIC_ADM_CONTRAT_SITU DACS WHERE T.NUMPAC =DACS.NUMPAC AND T.PACMAT =DACS.PACMAT AND DACS.PAIEZAD=T.PAIEZAD AND ( T.DEBUT_PERIODE_PAIE BETWEEN DSDSC AND NVL(DSFSC,TO_DATE(''31.12.2099'', ''DD.MM.YYYY'')) OR T.FIN_PERIODE_PAIE BETWEEN DSDSC AND NVL(DSFSC,TO_DATE(''31.12.2099'', ''DD.MM.YYYY'')) OR DSDSC BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) ) AS CODE_CHRONO FROM GAP_TRT_LISTE_MAT G , TGE_PERIODE_RECUEIL_PAIEZAD T , TGE_MODIF_PACMAT_RETRO PR, DIC_ADM_CONTRAT_HISTO H WHERE T.NUMPAC =? AND T.numpac = G.NUMPAC AND T.PACMAT = G.PACMAT AND T.MOIS_PAIE = PR.PERIODE_RETRO AND PR.PERIODE_RETRO >= ? AND PR.NUMPAC = G.NUMPAC AND PR.Pacmat = G.PACMAT AND G.ID_TRT = ? AND PR.TABLE_MAJ = ''PRD_PP_RETRO_INFOPAIE'' AND ( G.NUMPAC,G.PACMAT,PR.PERIODE_RETRO ) IN ( SELECT NUMPAC, PACMAT, PERIODE_RETRO FROM GAP_RETRO_MATRIC UNION ALL SELECT NUMPAC, PACMAT, PERIODE_RETRO FROM GAP_SELECTION_RETRO ) and H.NUMPAC   = T.NUMPAC AND H.PACMAT  = T.PACMAT AND H.PAIEZAD = T.PAIEZAD AND H.ZA996 = ''W'' '
##
TGE_REF_ENVOI_PAI
==
DELETE FROM TGE_REF_ENVOI_PAI where ORIGINE = 'RD' and CODE_REQ in ('PAI','PAI_RETRO')
##
TGE_REF_ENVOI_PAI (ORIGINE,CODE_REQ,ORDRE_REQ,REQUETE)
'RD','PAI','1','SELECT G.ID_TRT, T.NUMPAC, ''NORMAL'' AS TYPE_ENVOIE, T.MOIS_PAIE as PERIODE_PAIE, T.MOIS_PAIE as PERIODE_RETRO, T.PAIEZAD, T.PACMAT, T.DEBUT_PERIODE_PAIE, T.FIN_PERIODE_PAIE, T.ENTREE, T.SORTIE, NVL(T.DEBUT_PERIODE_RECUEIL,T.DEBUT_PERIODE_RECUEIL_LTP) AS DEBUT_PERIODE_RECUEIL, NVL(T.FIN_PERIODE_RECUEIL,T.FIN_PERIODE_RECUEIL_LTP) AS FIN_PERIODE_RECUEIL, CASE WHEN ( (T.ENTREE NOT BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE) AND (T.SORTIE NOT BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE) ) THEN ''PAI2'' ELSE ''PAI3'' END AS TYPEPAI , ( SELECT COUNT(*) FROM DIC_ADM_CONTRAT DAC WHERE T.NUMPAC =DAC.NUMPAC AND T.PACMAT =DAC.PACMAT AND DAC.CURRENT_PAIEZAD=T.PAIEZAD AND ( T.DEBUT_PERIODE_PAIE BETWEEN DSDCN AND NVL(DSFCN,TO_DATE(''31.12.2099'',''DD.MM.YYYY'')) OR T.FIN_PERIODE_PAIE BETWEEN DSDCN AND NVL(DSFCN,TO_DATE(''31.12.2099'',''DD.MM.YYYY'')) OR DSDCN BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) ) AS NB_CONTRAT , ( SELECT CODE_CHRONO FROM DIC_ADM_CONTRAT_SITU DACS WHERE T.NUMPAC =DACS.NUMPAC AND T.PACMAT =DACS.PACMAT AND DACS.PAIEZAD=T.PAIEZAD AND (T.DEBUT_PERIODE_PAIE BETWEEN DSDSC AND NVL(DSFSC,TO_DATE(''31.12.2099'',''DD.MM.YYYY'')) OR T.FIN_PERIODE_PAIE BETWEEN DSDSC AND NVL(DSFSC,TO_DATE(''31.12.2099'',''DD.MM.YYYY'')) OR DSDSC BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) ) AS CODE_CHRONO FROM GAP_TRT_LISTE_MAT G , TGE_PERIODE_RECUEIL_PAIEZAD T WHERE G.NUMPAC = ? AND T.numpac = G.NUMPAC AND T.PACMAT =G.PACMAT AND G.ID_TRT = ? AND t.mois_paie = ? AND (T.NUMPAC,T.PACMAT,T.PAIEZAD) IN ( SELECT H.NUMPAC,H.PACMAT,H.PAIEZAD FROM dic_adm_contrat_histo H WHERE H.za996   = ''W'') '
'RD','PAI_RETRO','1','SELECT G.ID_TRT, T.NUMPAC, ''RETRO'' AS TYPE_ENVOIE, ? AS PERIODE_PAIE, PR.PERIODE_RETRO AS PERIODE_RETRO, T.PAIEZAD, T.PACMAT, T.DEBUT_PERIODE_PAIE, T.FIN_PERIODE_PAIE, T.ENTREE, T.SORTIE, NVL(T.DEBUT_PERIODE_RECUEIL,T.DEBUT_PERIODE_RECUEIL_LTP) AS DEBUT_PERIODE_RECUEIL, NVL(T.FIN_PERIODE_RECUEIL,T.FIN_PERIODE_RECUEIL_LTP) AS FIN_PERIODE_RECUEIL, CASE WHEN ( ( T.ENTREE NOT BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) AND ( T.SORTIE NOT BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) ) THEN ''PAI2'' ELSE ''PAI3'' END AS TYPEPAI , ( SELECT COUNT(*) FROM DIC_ADM_CONTRAT DAC WHERE T.NUMPAC =DAC.NUMPAC AND T.PACMAT =DAC.PACMAT AND DAC.CURRENT_PAIEZAD=T.PAIEZAD AND ( T.DEBUT_PERIODE_PAIE BETWEEN DSDCN AND NVL(DSFCN,TO_DATE(''31.12.2099'', ''DD.MM.YYYY'')) OR T.FIN_PERIODE_PAIE BETWEEN DSDCN AND NVL(DSFCN,TO_DATE(''31.12.2099'', ''DD.MM.YYYY'')) OR DSDCN BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) ) AS NB_CONTRAT , ( SELECT CODE_CHRONO FROM DIC_ADM_CONTRAT_SITU DACS WHERE T.NUMPAC =DACS.NUMPAC AND T.PACMAT =DACS.PACMAT AND DACS.PAIEZAD=T.PAIEZAD AND ( T.DEBUT_PERIODE_PAIE BETWEEN DSDSC AND NVL(DSFSC,TO_DATE(''31.12.2099'', ''DD.MM.YYYY'')) OR T.FIN_PERIODE_PAIE BETWEEN DSDSC AND NVL(DSFSC,TO_DATE(''31.12.2099'', ''DD.MM.YYYY'')) OR DSDSC BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) ) AS CODE_CHRONO FROM GAP_TRT_LISTE_MAT G , TGE_PERIODE_RECUEIL_PAIEZAD T , TGE_MODIF_PACMAT_RETRO PR WHERE T.NUMPAC =? AND T.numpac = G.NUMPAC AND T.PACMAT = G.PACMAT AND T.MOIS_PAIE = PR.PERIODE_RETRO AND PR.PERIODE_RETRO >= ? AND PR.NUMPAC = G.NUMPAC AND PR.Pacmat = G.PACMAT AND G.ID_TRT = ? AND PR.TABLE_MAJ = ''PRD_PP_RETRO_INFOPAIE'' AND ( G.NUMPAC,G.PACMAT,PR.PERIODE_RETRO ) IN ( SELECT NUMPAC, PACMAT, PERIODE_RETRO FROM GAP_RETRO_MATRIC UNION ALL SELECT NUMPAC, PACMAT, PERIODE_RETRO FROM GAP_SELECTION_RETRO )  AND (T.NUMPAC,T.PACMAT,T.PAIEZAD) IN ( SELECT H.NUMPAC,H.PACMAT,H.PAIEZAD FROM dic_adm_contrat_histo H WHERE H.ZA996   = ''W'') '
##
TGE_REF_ENVOI_PAI
==
DELETE FROM TGE_REF_ENVOI_PAI where ORIGINE = 'RD' and CODE_REQ in ('PAI','PAI_RETRO')
##
TGE_REF_ENVOI_PAI (ORIGINE,CODE_REQ,ORDRE_REQ,REQUETE)
'RD','PAI','1','SELECT G.ID_TRT, T.NUMPAC, ''NORMAL'' AS TYPE_ENVOIE, T.MOIS_PAIE as PERIODE_PAIE, T.MOIS_PAIE as PERIODE_RETRO, T.PAIEZAD, T.PACMAT, T.DEBUT_PERIODE_PAIE, T.FIN_PERIODE_PAIE, T.ENTREE, T.SORTIE, NVL(T.DEBUT_PERIODE_RECUEIL,T.DEBUT_PERIODE_RECUEIL_LTP) AS DEBUT_PERIODE_RECUEIL, NVL(T.FIN_PERIODE_RECUEIL,T.FIN_PERIODE_RECUEIL_LTP) AS FIN_PERIODE_RECUEIL, CASE WHEN ( (T.ENTREE NOT BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE) AND (T.SORTIE NOT BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE) ) THEN ''PAI2'' ELSE ''PAI3'' END AS TYPEPAI , ( SELECT COUNT(*) FROM DIC_ADM_CONTRAT DAC WHERE T.NUMPAC =DAC.NUMPAC AND T.PACMAT =DAC.PACMAT AND DAC.CURRENT_PAIEZAD=T.PAIEZAD AND ( T.DEBUT_PERIODE_PAIE BETWEEN DSDCN AND NVL(DSFCN,TO_DATE(''31.12.2099'',''DD.MM.YYYY'')) OR T.FIN_PERIODE_PAIE BETWEEN DSDCN AND NVL(DSFCN,TO_DATE(''31.12.2099'',''DD.MM.YYYY'')) OR DSDCN BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) ) AS NB_CONTRAT , ( SELECT CODE_CHRONO FROM DIC_ADM_CONTRAT_SITU DACS WHERE T.NUMPAC =DACS.NUMPAC AND T.PACMAT =DACS.PACMAT AND DACS.PAIEZAD=T.PAIEZAD AND (T.DEBUT_PERIODE_PAIE BETWEEN DSDSC AND NVL(DSFSC,TO_DATE(''31.12.2099'',''DD.MM.YYYY'')) OR T.FIN_PERIODE_PAIE BETWEEN DSDSC AND NVL(DSFSC,TO_DATE(''31.12.2099'',''DD.MM.YYYY'')) OR DSDSC BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) ) AS CODE_CHRONO FROM GAP_TRT_LISTE_MAT G , TGE_PERIODE_RECUEIL_PAIEZAD T WHERE G.NUMPAC = ? AND T.numpac = G.NUMPAC AND T.PACMAT =G.PACMAT AND G.ID_TRT = ? AND t.mois_paie = ? AND (T.NUMPAC,T.PACMAT,T.PAIEZAD) IN ( SELECT H.NUMPAC,H.PACMAT,H.PAIEZAD FROM dic_adm_contrat_histo H WHERE H.za996   = ''W'') '
'RD','PAI_RETRO','1','SELECT G.ID_TRT, T.NUMPAC, ''RETRO'' AS TYPE_ENVOIE, ? AS PERIODE_PAIE, PR.PERIODE_RETRO AS PERIODE_RETRO, T.PAIEZAD, T.PACMAT, T.DEBUT_PERIODE_PAIE, T.FIN_PERIODE_PAIE, T.ENTREE, T.SORTIE, NVL(T.DEBUT_PERIODE_RECUEIL,T.DEBUT_PERIODE_RECUEIL_LTP) AS DEBUT_PERIODE_RECUEIL, NVL(T.FIN_PERIODE_RECUEIL,T.FIN_PERIODE_RECUEIL_LTP) AS FIN_PERIODE_RECUEIL, CASE WHEN ( ( T.ENTREE NOT BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) AND ( T.SORTIE NOT BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) ) THEN ''PAI2'' ELSE ''PAI3'' END AS TYPEPAI , ( SELECT COUNT(*) FROM DIC_ADM_CONTRAT DAC WHERE T.NUMPAC =DAC.NUMPAC AND T.PACMAT =DAC.PACMAT AND DAC.CURRENT_PAIEZAD=T.PAIEZAD AND ( T.DEBUT_PERIODE_PAIE BETWEEN DSDCN AND NVL(DSFCN,TO_DATE(''31.12.2099'', ''DD.MM.YYYY'')) OR T.FIN_PERIODE_PAIE BETWEEN DSDCN AND NVL(DSFCN,TO_DATE(''31.12.2099'', ''DD.MM.YYYY'')) OR DSDCN BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) ) AS NB_CONTRAT , ( SELECT CODE_CHRONO FROM DIC_ADM_CONTRAT_SITU DACS WHERE T.NUMPAC =DACS.NUMPAC AND T.PACMAT =DACS.PACMAT AND DACS.PAIEZAD=T.PAIEZAD AND ( T.DEBUT_PERIODE_PAIE BETWEEN DSDSC AND NVL(DSFSC,TO_DATE(''31.12.2099'', ''DD.MM.YYYY'')) OR T.FIN_PERIODE_PAIE BETWEEN DSDSC AND NVL(DSFSC,TO_DATE(''31.12.2099'', ''DD.MM.YYYY'')) OR DSDSC BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) ) AS CODE_CHRONO FROM GAP_TRT_LISTE_MAT G , TGE_PERIODE_RECUEIL_PAIEZAD T , TGE_MODIF_PACMAT_RETRO PR WHERE T.NUMPAC =? AND T.numpac = G.NUMPAC AND T.PACMAT = G.PACMAT AND T.MOIS_PAIE = PR.PERIODE_RETRO AND PR.PERIODE_RETRO >= ? AND PR.NUMPAC = G.NUMPAC AND PR.Pacmat = G.PACMAT AND G.ID_TRT = ? AND PR.TABLE_MAJ = ''PRD_PP_RETRO_INFOPAIE'' AND ( G.NUMPAC,G.PACMAT,PR.PERIODE_RETRO ) IN ( SELECT NUMPAC, PACMAT, PERIODE_RETRO FROM GAP_RETRO_MATRIC UNION ALL SELECT NUMPAC, PACMAT, PERIODE_RETRO FROM GAP_SELECTION_RETRO )  AND (T.NUMPAC,T.PACMAT,T.PAIEZAD) IN ( SELECT H.NUMPAC,H.PACMAT,H.PAIEZAD FROM dic_adm_contrat_histo H WHERE H.ZA996   = ''W'') '
##
TGE_REF_ENVOI_PAI
==
DELETE FROM TGE_REF_ENVOI_PAI where ORIGINE = 'RD' and CODE_REQ in ('PAI','PAI_RETRO')
##
TGE_REF_ENVOI_PAI (ORIGINE,CODE_REQ,ORDRE_REQ,REQUETE)
'RD','PAI','1','SELECT G.ID_TRT, T.NUMPAC, ''NORMAL'' AS TYPE_ENVOIE, T.MOIS_PAIE as PERIODE_PAIE, T.MOIS_PAIE as PERIODE_RETRO, T.PAIEZAD, T.PACMAT, T.DEBUT_PERIODE_PAIE, T.FIN_PERIODE_PAIE, T.ENTREE, T.SORTIE, NVL(T.DEBUT_PERIODE_RECUEIL,T.DEBUT_PERIODE_RECUEIL_LTP) AS DEBUT_PERIODE_RECUEIL, NVL(T.FIN_PERIODE_RECUEIL,T.FIN_PERIODE_RECUEIL_LTP) AS FIN_PERIODE_RECUEIL, CASE WHEN ( (T.ENTREE NOT BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE) AND (T.SORTIE NOT BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE) AND (T.SORTIE > T.FIN_PERIODE_PAIE AND T.ENTREE < T.DEBUT_PERIODE_PAIE ) ) THEN ''PAI2'' ELSE ''PAI3'' END AS TYPEPAI , ( SELECT COUNT(*) FROM DIC_ADM_CONTRAT DAC WHERE T.NUMPAC =DAC.NUMPAC AND T.PACMAT =DAC.PACMAT AND DAC.CURRENT_PAIEZAD=T.PAIEZAD AND ( T.DEBUT_PERIODE_PAIE BETWEEN DSDCN AND NVL(DSFCN,TO_DATE(''31.12.2099'',''DD.MM.YYYY'')) OR T.FIN_PERIODE_PAIE BETWEEN DSDCN AND NVL(DSFCN,TO_DATE(''31.12.2099'',''DD.MM.YYYY'')) OR DSDCN BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) ) AS NB_CONTRAT , ( SELECT CODE_CHRONO FROM DIC_ADM_CONTRAT_SITU DACS WHERE T.NUMPAC =DACS.NUMPAC AND T.PACMAT =DACS.PACMAT AND DACS.PAIEZAD=T.PAIEZAD  AND (T.DEBUT_PERIODE_PAIE BETWEEN DSDSC AND NVL(DSFSC,TO_DATE(''31.12.2099'',''DD.MM.YYYY'')) OR T.FIN_PERIODE_PAIE BETWEEN DSDSC AND NVL(DSFSC,TO_DATE(''31.12.2099'',''DD.MM.YYYY''))  OR DSDSC BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) ) AS CODE_CHRONO  ,CASE WHEN UPPER(?)=''TRUE'' AND T.SORTIE < T.FIN_PERIODE_PAIE AND  T.SORTIE > TO_DATE(?,''YYYYMMDD'') THEN ''O'' ELSE ''N'' END  as PEREXT FROM GAP_TRT_LISTE_MAT G , TGE_PERIODE_RECUEIL_PAIEZAD T WHERE G.NUMPAC = ? AND T.numpac = G.NUMPAC AND T.PACMAT =G.PACMAT AND G.ID_TRT = ? AND t.mois_paie = ? AND (T.NUMPAC,T.PACMAT,T.PAIEZAD) IN ( SELECT H.NUMPAC,H.PACMAT,H.PAIEZAD FROM dic_adm_contrat_histo H WHERE upper(H.za996) = ''W'') '
'RD','PAI_RETRO','1','SELECT G.ID_TRT, T.NUMPAC, ''RETRO'' AS TYPE_ENVOIE, ? AS PERIODE_PAIE, PR.PERIODE_RETRO AS PERIODE_RETRO, T.PAIEZAD, T.PACMAT, T.DEBUT_PERIODE_PAIE, T.FIN_PERIODE_PAIE, T.ENTREE, T.SORTIE, NVL(T.DEBUT_PERIODE_RECUEIL,T.DEBUT_PERIODE_RECUEIL_LTP) AS DEBUT_PERIODE_RECUEIL, NVL(T.FIN_PERIODE_RECUEIL,T.FIN_PERIODE_RECUEIL_LTP) AS FIN_PERIODE_RECUEIL, CASE WHEN ( ( T.ENTREE NOT BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) AND ( T.SORTIE NOT BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) ) THEN ''PAI2'' ELSE ''PAI3'' END AS TYPEPAI , ( SELECT COUNT(*) FROM DIC_ADM_CONTRAT DAC WHERE T.NUMPAC =DAC.NUMPAC AND T.PACMAT =DAC.PACMAT AND DAC.CURRENT_PAIEZAD=T.PAIEZAD AND ( T.DEBUT_PERIODE_PAIE BETWEEN DSDCN AND NVL(DSFCN,TO_DATE(''31.12.2099'', ''DD.MM.YYYY'')) OR T.FIN_PERIODE_PAIE BETWEEN DSDCN AND NVL(DSFCN,TO_DATE(''31.12.2099'', ''DD.MM.YYYY'')) OR DSDCN BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) ) AS NB_CONTRAT , ( SELECT CODE_CHRONO FROM DIC_ADM_CONTRAT_SITU DACS WHERE T.NUMPAC =DACS.NUMPAC AND T.PACMAT =DACS.PACMAT AND DACS.PAIEZAD=T.PAIEZAD AND ( T.DEBUT_PERIODE_PAIE BETWEEN DSDSC AND NVL(DSFSC,TO_DATE(''31.12.2099'', ''DD.MM.YYYY'')) OR T.FIN_PERIODE_PAIE BETWEEN DSDSC AND NVL(DSFSC,TO_DATE(''31.12.2099'', ''DD.MM.YYYY'')) OR DSDSC BETWEEN T.DEBUT_PERIODE_PAIE AND T.FIN_PERIODE_PAIE ) ) AS CODE_CHRONO ,''N'' as PEREXT FROM GAP_TRT_LISTE_MAT G , TGE_PERIODE_RECUEIL_PAIEZAD T , TGE_MODIF_PACMAT_RETRO PR WHERE T.NUMPAC =? AND T.numpac = G.NUMPAC AND T.PACMAT = G.PACMAT AND T.MOIS_PAIE = PR.PERIODE_RETRO AND PR.PERIODE_RETRO >= ? AND PR.NUMPAC = G.NUMPAC AND PR.Pacmat = G.PACMAT AND G.ID_TRT = ? AND PR.TABLE_MAJ = ''PRD_PP_RETRO_INFOPAIE'' AND ( G.NUMPAC,G.PACMAT,PR.PERIODE_RETRO ) IN ( SELECT NUMPAC, PACMAT, PERIODE_RETRO FROM GAP_RETRO_MATRIC UNION ALL SELECT NUMPAC, PACMAT, PERIODE_RETRO FROM GAP_SELECTION_RETRO )  AND (T.NUMPAC,T.PACMAT,T.PAIEZAD) IN ( SELECT H.NUMPAC,H.PACMAT,H.PAIEZAD FROM dic_adm_contrat_histo H WHERE UPPER(H.ZA996)   = ''W'') '
