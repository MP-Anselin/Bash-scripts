##
TRG_PERSO_HISTO_AFTER_STMNT
=SQL=
CREATE OR REPLACE FUNCTION TRG_PERSO_HISTO_AFTER_STMNT RETURN CLOB AS 
BEGIN
  RETURN '
  IF v_listMatricToUpdate IS NOT NULL THEN
    -- On insère dans la table temporaire les MATRIC à mettre à jour
    --DBMS_OUTPUT.PUT_LINE(''PERSO_HISTO UPDATING ''||v_listMatricToUpdate);
    --FIXME utiliser la procédure trace_dbms_output()
    EXECUTE_IMMEDIATE_STRING (''INSERT INTO SECUPACMAT_TMP_PERSO (MATRIC) SELECT DISTINCT MATRIC FROM SECUPACMAT WHERE MATRIC IN (''||v_listMatricToUpdate||'')'',0);
    SECNAV_MAJ_CURRENT_PERSO(''DO_MAJ'', 0, 1, 0);
    ALIM_IDX_PERSO_HISTO(1);
    EXECUTE_IMMEDIATE_STRING( ''DELETE FROM SECUPACMAT_TMP_PERSO'',0);
  END IF;
';
END TRG_PERSO_HISTO_AFTER_STMNT;
