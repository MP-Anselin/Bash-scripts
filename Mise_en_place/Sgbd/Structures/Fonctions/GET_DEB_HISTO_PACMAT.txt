##
TAG_CHARSET=@€ιθη
##
GET_DEB_HISTO_PACMAT
=SQL=
CREATE OR REPLACE FUNCTION GET_DEB_HISTO_PACMAT(P_NUMPAC VARCHAR2, P_PACMAT VARCHAR2 ) RETURN VARCHAR2 IS 
  v_debHistoPacmat VARCHAR2(6);
BEGIN 
  SELECT  GREATEST(DEB_HISTO_RETRO, TO_CHAR(ADD_MONTHS(TO_DATE(PERIODEENCOURS, 'YYYYMM'), -NB_MOIS_RETRO), 'YYYYMM'),NVL( PREMIERE_PAIE, '190101')) 
  INTO  v_debHistoPacmat 
  FROM TGE_REF_PAC T
  LEFT JOIN SECUPACMAT S ON S.NUMPAC=T.NUMPAC AND S.PACMAT = P_PACMAT
  WHERE DEB_HISTO_RETRO IS NOT NULL 
  AND T.NUMPAC = P_NUMPAC;
  RETURN v_debHistoPacmat;
  EXCEPTION WHEN NO_DATA_FOUND
  THEN RETURN null;
END GET_DEB_HISTO_PACMAT ;