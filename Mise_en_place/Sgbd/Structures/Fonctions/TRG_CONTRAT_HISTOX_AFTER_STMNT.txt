##
TAG_CHARSET=@€éèç
##
TRG_CONTRAT_HISTOX_AFTER_STMNT
=SQL=
CREATE OR REPLACE FUNCTION TRG_CONTRAT_HISTOX_AFTER_STMNT ( nbExtension in number) RETURN CLOB AS 
BEGIN
  RETURN '
  IF v_listMatricToUpdate IS NOT NULL THEN
    -- Insère dans la table temporaire les NUMPAC/PACMAT/MATRIC à mettre à jour
    --DBMS_OUTPUT.PUT_LINE(''CONTRAT_HISTO UPDATING ''||v_listMatricToUpdate);
    --FIXME utiliser la procédure trace_dbms_output()
    EXECUTE_IMMEDIATE_STRING (''INSERT INTO SECUPACMAT_TMP_CONTRAT (NUMPAC, PACMAT, MATRIC) SELECT DISTINCT NUMPAC, PACMAT, MATRIC FROM SECUPACMAT WHERE MATRIC IN (''||v_listMatricToUpdate||'')'',0);
    SECNAV_MAJ_DATA_CONTRAT_HISTO'||nbExtension||'(0);
    DELETE FROM SECUPACMAT_TMP_CONTRAT;    
  END IF;
';
END TRG_CONTRAT_HISTOX_AFTER_STMNT;
