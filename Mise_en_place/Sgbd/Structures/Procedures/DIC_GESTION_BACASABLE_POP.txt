##
DIC_GESTION_BACASABLE_POP
=SQL=
create or replace PROCEDURE DIC_GESTION_BACASABLE_POP AS
v_nbMatric NUMBER(10);
 BEGIN
 DELETE FROM CLE_BAC_A_SABLE;
 SELECT COUNT(MATRIC) into v_nbMatric from MATRIC_BAC_A_SABLE;
 IF v_nbMatric = 0 then
  INSERT INTO MATRIC_BAC_A_SABLE SELECT MATRIC FROM (select DISTINCT MATRIC from secupacmat ORDER BY MATRIC DESC) WHERE ROWNUM < 500;
 END IF;
 INSERT INTO CLE_BAC_A_SABLE (NUMPAC,PACMAT,PAIEZAD,MATRIC) SELECT DISTINCT DACH.NUMPAC,DACH.PACMAT,DACH.PAIEZAD,DACH.MATRIC FROM DIC_ADM_CONTRAT_HISTO DACH,MATRIC_BAC_A_SABLE WHERE DACH.MATRIC = MATRIC_BAC_A_SABLE.MATRIC;
 END DIC_GESTION_BACASABLE_POP;
