##
CREATE_PROC_DACHX_HORS_TRANSAC
=SQL=
create or replace PROCEDURE CREATE_PROC_DACHX_HORS_TRANSAC (NOM_TABLE IN VARCHAR2)  AS 
PROC clob;
extension varchar2(1);
BEGIN
extension := replace(nom_table,'DIC_ADM_CONTRAT_HISTO','');
PROC := 'create or replace FUNCTION GET_CONTRAT_HISTO' || extension || '_HORS_TRANSAC(p_numpac VARCHAR2, p_pacmat VARCHAR2, p_numcnt NUMBER, p_dateEff DATE, p_useBetween BOOLEAN DEFAULT FALSE) RETURN ' || NOM_TABLE||'%ROWTYPE IS PRAGMA AUTONOMOUS_TRANSACTION;
 retour ' || NOM_TABLE||'%ROWTYPE;
 BEGIN
 IF p_useBetween THEN
 SELECT * INTO retour FROM ' || NOM_TABLE||' WHERE NUMPAC=p_numpac AND PACMAT=p_pacmat AND NUMCNT=p_numcnt AND p_dateEff BETWEEN DATE_EFF AND DATE_FIN;
 ELSE
 SELECT * INTO retour FROM ' || NOM_TABLE||' WHERE NUMPAC=p_numpac AND PACMAT=p_pacmat AND NUMCNT=p_numcnt AND DATE_EFF=p_dateEff;
 END IF;
 RETURN retour;
 EXCEPTION
 WHEN OTHERS THEN RETURN NULL;
 END GET_CONTRAT_HISTO' || extension || '_HORS_TRANSAC;';
 
 EXECUTE IMMEDIATE PROC;
 
END CREATE_PROC_DACHX_HORS_TRANSAC;
