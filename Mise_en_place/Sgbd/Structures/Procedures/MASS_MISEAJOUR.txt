##
MASS_MISAJOUR
=SQL=
CREATE OR REPLACE PROCEDURE MASS_MISEAJOUR 
(
  P_NUMSAISIE IN VARCHAR2 
, P_NUMPAC IN VARCHAR2 
, P_PACMAT IN VARCHAR2 
, P_NUMCNT IN VARCHAR2 
, P_DATE_EFF IN DATE 
, P_NOMDONNEE IN VARCHAR2 
, P_VALEUR IN VARCHAR2 
, P_VALIDE IN VARCHAR2
) IS 
valeurmodifier  NUMBER(38,3) :=0;   
BEGIN
  select count(*) into valeurmodifier  from MASS_SAISIES where NUM_SAISIE =  P_NUMSAISIE
			   AND NUMPAC = P_NUMPAC
			   AND  PACMAT = P_PACMAT
			   AND  NUMCNT = P_NUMCNT
			   AND DATE_EFF = P_DATE_EFF
         AND NOM_DONNEE = P_NOMDONNEE
         AND NVL(VALEUR_SAISIE,'XYZ') = NVL(P_VALEUR,'XYZ');  
  
  --la valeur a été modifier
  IF valeurmodifier = 0 THEN
    UPDATE MASS_SAISIES_LIGNE SET MODIFIE='O', VALIDE = NVL(P_VALIDE, 'N') WHERE NUM_SAISIE =  P_NUMSAISIE
			   AND NUMPAC = P_NUMPAC
			   AND  PACMAT = P_PACMAT
			   AND  NUMCNT = P_NUMCNT
			   AND DATE_EFF = P_DATE_EFF;
   
    UPDATE MASS_SAISIES SET    
			   VALEUR_SAISIE = P_VALEUR
			   WHERE  NUM_SAISIE =  P_NUMSAISIE
			   AND NUMPAC = P_NUMPAC
			   AND  PACMAT = P_PACMAT
			   AND  NUMCNT = P_NUMCNT
			   AND DATE_EFF = P_DATE_EFF
			   AND  NOM_DONNEE = P_NOMDONNEE;
  
  
  END IF;
  
  
END MASS_MISEAJOUR;
