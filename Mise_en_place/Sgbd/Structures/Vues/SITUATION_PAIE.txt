##
SITUATION_PAIE
=SQL=
CREATE OR REPLACE FORCE VIEW SITUATION_PAIE ("NUMPAC", "PACMAT", "NUMCNT", "PAIEZAD", "DSDSC", "DSFSC", "TYPE_CHANG_SITU", "CODE_CHRONO", "MATRIC", "IDPACMAT", "DATE_CREATION", "DATE_DERNIERE_MODIF", "PERIODEENCOURS", "RETRO_ENTREE", "RETRO_SORTIE") AS 
SELECT SITU.NUMPAC,
SITU.PACMAT,
SITU.NUMCNT,
SITU.PAIEZAD,
SITU.DSDSC,     
SITU.DSFSC,
SITU.TYPE_CHANG_SITU,
SITU.CODE_CHRONO,
SITU.MATRIC,
SITU.IDPACMAT,
SITU.DATE_CREATION,
SITU.DATE_DERNIERE_MODIF,
PAC.PERIODEENCOURS,
CASE WHEN SITU.DSDSC < TO_DATE(PER.DATE_DEBUT_MOIS,'yyyymmdd') 
  AND (P.PACMAT IS NULL 
  	OR NVL(P.DSDCN, TO_DATE('01.01.1700', 'dd.MM.yyyy')) != NVL(SITU.DSDSC, TO_DATE('01.01.1700', 'dd.MM.yyyy'))
  )
  THEN 'O' ELSE 'N' END AS RETRO_ENTREE,
  
CASE WHEN SITU.DSFSC < TO_DATE(PER.DATE_DEBUT_MOIS,'yyyymmdd') 
  AND (P.PACMAT IS NULL 
  	OR NVL(P.DSFCN, TO_DATE('01.01.1700', 'dd.MM.yyyy')) != NVL(SITU.DSFSC, TO_DATE('01.01.1700', 'dd.MM.yyyy'))
  )
  THEN 'O' ELSE 'N' END AS RETRO_SORTIE
 FROM DIC_ADM_CONTRAT_SITU SITU INNER JOIN TGE_REF_PAC PAC ON SITU.NUMPAC = PAC.NUMPAC 
  INNER JOIN TGE_REF_PER PER ON PER.NUMPAC = SITU.NUMPAC AND PER.PERIODEENCOURS = PAC.PERIODEENCOURS
  LEFT JOIN PHOTO_DIC_ADM_CONTRAT P
    ON SITU.NUMPAC  = P.NUMPAC
    AND SITU.PACMAT = P.PACMAT
    AND SITU.NUMCNT = P.NUMCNT
    