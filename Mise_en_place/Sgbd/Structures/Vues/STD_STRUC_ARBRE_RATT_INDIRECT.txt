##
TAG_CHARSET=@€ιθη
##
STD_STRUC_ARBRE_RATT_INDIRECT
==
CREATE OR REPLACE FORCE VIEW "STD_STRUC_ARBRE_RATT_INDIRECT" ("CID", "CODE_ENTITE", "TYPE_ENTITE", "CODTS", "DATE_EFF", "CODE_ENT_MERE", "DATE_FIN", "TYPE_ENT_MERE", "DATE_EFF_RATT_DIRECTE", "CODE_ENTITE_RATT_DIRECTE", "DATE_FIN_RATT_DIRECTE", "TYPE_ENTITE_RATT_DIRECTE", "PROFONDEUR") AS   WITH rattachements (cid, code_entite, type_entite, codts, date_eff, code_ent_mere, date_fin, type_ent_mere, date_eff_ratt, code_entite_ratt, date_fin_ratt, type_entite_ratt, profondeur) AS (SELECT ar.cid, ar.code_entite,(SELECT type_entite FROM std_struc_entite e WHERE e.cid = ar.cid and e.code_entite=ar.code_entite AND ar.date_eff BETWEEN e.date_eff AND e.date_fin),ar.codts,ar.date_eff,ar.code_ent_mere,ar.date_fin,(SELECT type_entite FROM std_struc_entite e WHERE e.cid = ar.cid and e.code_entite=ar.code_ent_mere AND ar.date_eff BETWEEN e.date_eff AND e.date_fin),ar.date_eff,ar.code_ent_mere,ar.date_fin,(SELECT type_entite FROM std_struc_entite e WHERE e.cid = ar.cid and e.code_entite=ar.code_ent_mere AND ar.date_eff BETWEEN e.date_eff AND e.date_fin),0 AS profondeur FROM std_struc_arbre ar WHERE ar.statut='1' UNION ALL SELECT rat.cid, rat.code_entite,(SELECT type_entite FROM std_struc_entite e WHERE e.cid = rat.cid and e.code_entite=rat.code_entite AND rat.date_eff BETWEEN e.date_eff AND e.date_fin),rat.codts,CASE WHEN ar.date_eff<rat.date_eff THEN rat.date_eff ELSE ar.date_eff END AS date_eff,ar.code_ent_mere,CASE WHEN ar.date_fin<rat.date_fin THEN ar.date_fin ELSE rat.date_fin END AS date_fin,(SELECT type_entite FROM std_struc_entite e WHERE e.cid = ar.cid and e.code_entite=ar.code_ent_mere AND ar.date_eff BETWEEN e.date_eff AND e.date_fin),rat.date_eff_ratt,rat.code_entite_ratt,rat.date_fin_ratt,rat.type_entite_ratt,profondeur+1 FROM rattachements rat,std_struc_arbre ar WHERE rat.cid = ar.cid and rat.codts =ar.codts AND rat.code_ent_mere =ar.code_entite AND ar.date_eff <=rat.date_fin AND ar.date_fin >=rat.date_eff) SELECT CID, CODE_ENTITE,TYPE_ENTITE,CODTS,DATE_EFF,CODE_ENT_MERE,DATE_FIN,TYPE_ENT_MERE,DATE_EFF_RATT,CODE_ENTITE_RATT,DATE_FIN_RATT,TYPE_ENTITE_RATT,PROFONDEUR FROM rattachements
