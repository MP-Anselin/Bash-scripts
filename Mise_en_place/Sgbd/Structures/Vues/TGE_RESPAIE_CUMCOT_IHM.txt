##
TAG_CHARSET=@€ιθη
##
TGE_RESPAIE_CUMCOT_IHM
=SQL=
CREATE OR REPLACE VIEW TGE_RESPAIE_CUMCOT_IHM AS 
SELECT 
  DTR.NUMPAC,
  DTR.PAIEZAD,
  DTR.PACMAT,
  DACS.NUMCNT,
  TO_CHAR(DTR.DTDEB_CUMCOT,'DD.MM.YYYY') AS DTDEB_CUMCOT,
  DTR.DTDEB_CUMCOT AS DTDEB_CUMCOT_FMT,
  TO_CHAR(DTR.DTDEB_CUMCOT,'YYYYMMDD') AS DTDEB_CUMCOT_TRI,
  TO_CHAR(DTR.DTDEB_CUMCOT,'YYYY') AS DTDEB_CUMCOT_YYYY,
  REGEXP_REPLACE(TO_CHAR(DTR.DTDEB_CUMCOT,'Month YYYY'),'[ ]+',' ') AS DTDEB_CUMCOT_AFF,
  DTR.CAISSE_CUMCOT,
  DTR.ABRT,
  DTR.ANBT,
  DTR.ABSA,
  DTR.ABSB,
  DTR.ABSC,
  DTR.ALB5,
  DTR.APFA,
  DTR.APFB,
  case 
  	when DACS.DSFSC=to_date('20991231','yyyymmdd') 
  	then 'A partir du '||to_char(DACS.DSDSC, 'DD.MM.YYYY') 
  	else 'Du '||to_char(DACS.DSDSC, 'DD.MM.YYYY')||' au '||to_char(DACS.DSFSC, 'DD.MM.YYYY')
  end as LIB_PERIODE_EMPLOI,
  case 
    when DACS.DSFSC=to_date('20991231','yyyymmdd') 
    then to_char(DACS.DSDSC, 'DD.MM.YYYY') 
    else to_char(DACS.DSDSC, 'DD.MM.YYYY')||' au '||to_char(DACS.DSFSC, 'DD.MM.YYYY')
  end as LIB_PERIODE_EMPLOI_2
FROM
  DIC_TGE_RESPAIE_CUMCOT DTR
  , DIC_ADM_CONTRAT_SITU DACS 
WHERE DACS.NUMPAC=DTR.NUMPAC AND DACS.PAIEZAD=DTR.PAIEZAD AND DACS.NUMCNT=(
 SELECT MAX(DACH.NUMCNT)
 FROM DIC_ADM_CONTRAT_HISTO DACH
 WHERE DACH.NUMPAC=DTR.NUMPAC AND DACH.PAIEZAD=DTR.PAIEZAD
 and DACH.PACMAT = DACS.PACMAT
 AND DTR.DTDEB_CUMCOT BETWEEN TRUNC(DACH.DATE_EFF,'mm') AND DACH.DATE_FIN_BO
)
