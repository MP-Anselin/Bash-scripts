##
TAG_CHARSET=@€ιθη
##
TGE_RESPAIE_CUMASO_IHM
=SQL=
CREATE OR REPLACE VIEW TGE_RESPAIE_CUMASO_IHM AS
SELECT 
  DTR.NUMPAC,
  DTR.PAIEZAD,
  DTR.PACMAT,
  DACS.NUMCNT,
  TO_CHAR(DTR.DTDEB_CUMASO,'DD.MM.YYYY') AS DTDEB_CUMASO,
  DTR.DTDEB_CUMASO AS DTDEB_CUMASO_FMT,
  TO_CHAR(DTR.DTDEB_CUMASO,'YYYYMMDD') AS DTDEB_CUMASO_TRI,
  DTR.BRUTRE,
  DTR.BRUTSS,
  DTR.BRUTIM,
  DTR.NETFIS,
  DTR.AVANTA,
  case 
  	when DACS.DSFSC=to_date('20991231','yyyymmdd') 
  	then 'A partir du '||to_char(DACS.DSDSC, 'DD.MM.YYYY') 
  	else 'Du '||to_char(DACS.DSDSC, 'DD.MM.YYYY')||' au '||to_char(DACS.DSFSC, 'DD.MM.YYYY')
  end as LIB_PERIODE_EMPLOI,
  case 
    when DACS.DSFSC=to_date('20991231','yyyymmdd') 
    then to_char(DACS.DSDSC, 'DD.MM.YYYY') 
    else to_char(DACS.DSDSC, 'DD.MM.YYYY')||' au '||to_char(DACS.DSFSC, 'DD.MM.YYYY')
  end as LIB_PERIODE_EMPLOI_2
FROM
  DIC_TGE_RESPAIE_CUMASO DTR
  , DIC_ADM_CONTRAT_SITU DACS 
WHERE DACS.NUMPAC=DTR.NUMPAC AND DACS.PAIEZAD=DTR.PAIEZAD AND DACS.NUMCNT=(
 SELECT MAX(DACH.NUMCNT)
 FROM DIC_ADM_CONTRAT_HISTO DACH
 WHERE DACH.NUMPAC=DTR.NUMPAC AND DACH.PAIEZAD=DTR.PAIEZAD
 and DACH.PACMAT = DACS.PACMAT
 AND DTR.DTDEB_CUMASO BETWEEN TRUNC(DACH.DATE_EFF,'mm') AND DACH.DATE_FIN_BO
)
