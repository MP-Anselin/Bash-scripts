##
TAG_CHARSET=@€ιθη
##
TGE_RESPAIE_CUMCOTM_IHM
=SQL=
CREATE OR REPLACE VIEW TGE_RESPAIE_CUMCOTM_IHM AS 
SELECT 
  DTR.NUMPAC,
  DTR.PAIEZAD,
  DTR.PACMAT,
  DACS.NUMCNT,
  TO_CHAR(DTR.DTDEB_CUMCOTM,'DD.MM.YYYY') AS DTDEB_CUMCOTM,
  DTR.DTDEB_CUMCOTM AS DTDEB_CUMCOTM_FMT,
  TO_CHAR(DTR.DTDEB_CUMCOTM,'YYYYMMDD') AS DTDEB_CUMCOTM_TRI,
  TO_CHAR(DTR.DTDEB_CUMCOTM,'YYYY') AS DTDEB_CUMCOTM_YYYY,
  REGEXP_REPLACE(TO_CHAR(DTR.DTDEB_CUMCOTM,'Month YYYY'),'[ ]+',' ') AS DTDEB_CUMCOTM_AFF,
  DTR.CAISSE_CUMCOTM,
  DTR.NBRT,
  DTR.NNBT,
  DTR.NBSA,
  DTR.NBSB,
  DTR.NBSC,
  DTR.MLB101_CUMCOTM,
  DTR.NBSD,
  DTR.NAPFA,
  DTR.NAPFB,
  DTR.NAPFC,
  DTR.NMTS,
  DTR.NMTP,
  DTR.NLB9,
  DTR.NBSIAC,
  DTR.NBSBSI,
  DTR.NBSCSI,
  case 
  	when DACS.DSFSC=to_date('20991231','yyyymmdd') 
  	then 'A partir du '||to_char(DACS.DSDSC, 'DD.MM.YYYY') 
  	else 'Du '||to_char(DACS.DSDSC, 'DD.MM.YYYY')||' au '||to_char(DACS.DSFSC, 'DD.MM.YYYY')
  end as LIB_PERIODE_EMPLOI,
  case 
    when DACS.DSFSC=to_date('20991231','yyyymmdd') 
    then to_char(DACS.DSDSC, 'DD.MM.YYYY') 
    else to_char(DACS.DSDSC, 'DD.MM.YYYY')||' au '||to_char(DACS.DSFSC, 'DD.MM.YYYY')
  end as LIB_PERIODE_EMPLOI_2
FROM
  DIC_TGE_RESPAIE_CUMCOTM DTR
  , DIC_ADM_CONTRAT_SITU DACS 
WHERE DACS.NUMPAC=DTR.NUMPAC AND DACS.PAIEZAD=DTR.PAIEZAD AND DACS.NUMCNT=(
 SELECT MAX(DACH.NUMCNT)
 FROM DIC_ADM_CONTRAT_HISTO DACH
 WHERE DACH.NUMPAC=DTR.NUMPAC AND DACH.PAIEZAD=DTR.PAIEZAD
 and DACH.PACMAT = DACS.PACMAT
 AND DTR.DTDEB_CUMCOTM BETWEEN TRUNC(DACH.DATE_EFF,'mm') AND DACH.DATE_FIN_BO
)
