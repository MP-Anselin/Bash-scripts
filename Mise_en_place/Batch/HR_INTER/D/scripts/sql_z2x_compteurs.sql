insert into std_compteurs select MATRIC,to_char(sysdate,'yyyyMMdd') ,rpad(upper(code_compteur), 5),nvl(to_char(to_date(datedeb,'dd/MM/RR'),'yyyyMMdd'),to_char(to_date(date_debut_validite,'dd/MM/RR'),'yyyyMMdd')),'','H',droit_valeur_compteur,'H',DIF_PRIS_TT+DIF_PRIS_HORSTT,'H',droit_restant,'','','','','','','','','','','','','','','','','','' from z2x_batch_compteur where to_char(to_date(date_debut_validite,'dd/mm/yyyy'),'yyyy')=to_char(sysdate,'yyyy') and (matric,rpad(upper(code_compteur), 5),droit_valeur_compteur,pris_valeur_compteur,droit_restant) not in (select matric,typecompteur,valcp1,valcp2,valcp3 from std_compteurs);
