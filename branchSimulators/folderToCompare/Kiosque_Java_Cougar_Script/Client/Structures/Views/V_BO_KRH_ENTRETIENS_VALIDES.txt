##
V_BO_KRH_ENTRETIENS_VALIDES
=SQL=
CREATE OR REPLACE VIEW V_BO_KRH_ENTRETIENS_VALIDES ("ID_ENTRETIEN","ORIGINE","DATE_ENTRETIEN","LIBELLE","TYPOLOGIE_LIBELLE","ELIGIBILITE_BILAN_6ANS","STATUT","COMMENTAIRE_REFUS","COLLABORATEUR","NOM_ACTEUR","PRENOM_ACTEUR","ROLE_ACTEUR","ID_TYPOLOGIE") AS 
select
  ent.ID_ENTRETIEN,
  case DATA_SOURCE when 'INT' then 'SAISIE' else 'HISTO' end ORIGINE,
  ent.DATE_ENTRETIEN,
  ent.TRAME_LIBELLE as LIBELLE,
  ent.TYPOLOGIE_LIBELLE,
  ent.ELIGIBILITE_BILAN_6ANS,
  ent.STATUT,
  ent.COMMENTAIRE_REFUS,
  collab.MATRICULE as COLLABORATEUR,
  nvl(act_sal.NOM, act.NOM) as NOM_ACTEUR,
  nvl(act_sal.PRENOM, act.PRENOM) as PRENOM_ACTEUR,
  ent.ACTEUR_ROLE as ROLE_ACTEUR,
  null as ID_TYPOLOGIE  -- Colonne à supprimer dès que BO ne l'utilisera plus
from T_DI_ENTRETIEN ent
join T_DI_COLLABORATEUR collab on collab.ID_COLLABORATEUR = ent.ID_COLLABORATEUR
left join T_DI_COLLABORATEUR act on act.ID_COLLABORATEUR = ent.ACTEUR
left join T_V5_KRH_SALARIE act_sal on act_sal.MATRICULE = act.MATRICULE
