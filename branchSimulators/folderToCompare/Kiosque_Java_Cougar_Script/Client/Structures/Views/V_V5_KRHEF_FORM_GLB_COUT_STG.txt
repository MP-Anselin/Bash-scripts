##
V_V5_KRHEF_FORM_GLB_COUT_STG
=SQL=
CREATE OR REPLACE VIEW V_V5_KRHEF_FORM_GLB_COUT_STG ("ID_INSCRIPTION_REF","ID_SESSION_REF","ORDRE_PLAN","TOTAL_COUT","TOTAL_PEC","MAINTIEN_SALAIRE_STAGIAIRE","SALAIRE_HTT","FONCTIONNEMENT_PEDAGO","HEBERGEMENT_RESTAURATION","TRANSPORT","MATERIEL","TUTORAT","COUT_FORMATEUR","FRAIS_PERSO_FORMATEUR_INT","FRAIS_PERSO_FORMATEUR_EXT","LOCAUX_ENTRETIEN","ORGANISATION_ADMINISTRATIVE","PEC_MAINTIEN_SALAIRE_STAGIAIRE","PEC_SALAIRE_HTT","PEC_FONCTIONNEMENT_PEDAGO","PEC_HEBERGEMENT_RESTAURATION","PEC_TRANSPORT","PEC_MATERIEL","PEC_TUTORAT","PEC_COUT_FORMATEUR","PEC_FRAIS_PERSO_FORMATEUR_INT","PEC_FRAIS_PERSO_FORMATEUR_EXT","PEC_LOCAUX_ENTRETIEN","PEC_ORGANISATION_ADMIN") AS 
select md.ID_INSCRIPTION_REF
         , ses.ID_SESSION_REF
         , md.ORDRE_PLAN

           -- Total des couts
         ,   sum(md.MAINTIEN_SALAIRE_STAGIAIRE)
           + sum(md.SALAIRE_HTT)
           + sum(md.FONCTIONNEMENT_PEDAGO)
           + sum(md.HEBERGEMENT_RESTAURATION)
           + sum(md.TRANSPORT)
           + sum(md.MATERIEL)
           + sum(md.TUTORAT)
           + sum(md.COUT_FORMATEUR)
           + sum(md.FRAIS_PERSO_FORMATEUR_INT)
           + sum(md.FRAIS_PERSO_FORMATEUR_EXT)
           + sum(md.LOCAUX_ENTRETIEN)
           + sum(md.ORGANISATION_ADMINISTRATIVE)
         as TOTAL_COUT

         -- Total des PEC
         ,   sum(md.PEC_MAINTIEN_SALAIRE_STAGIAIRE)
           + sum(md.PEC_SALAIRE_HTT)
           + sum(md.PEC_FONCTIONNEMENT_PEDAGO)
           + sum(md.PEC_HEBERGEMENT_RESTAURATION)
           + sum(md.PEC_TRANSPORT)
           + sum(md.PEC_MATERIEL)
           + sum(md.PEC_TUTORAT)
           + sum(md.PEC_COUT_FORMATEUR)
           + sum(md.PEC_FRAIS_PERSO_FORMATEUR_INT)
           + sum(md.PEC_FRAIS_PERSO_FORMATEUR_EXT)
           + sum(md.PEC_LOCAUX_ENTRETIEN)
           + sum(md.PEC_ORGANISATION_ADMIN)
         as TOTAL_PEC

           -- Détail des couts
         , sum(md.MAINTIEN_SALAIRE_STAGIAIRE) as MAINTIEN_SALAIRE_STAGIAIRE
         , sum(md.SALAIRE_HTT) as SALAIRE_HTT
         , sum(md.FONCTIONNEMENT_PEDAGO) as FONCTIONNEMENT_PEDAGO
         , sum(md.HEBERGEMENT_RESTAURATION) as HEBERGEMENT_RESTAURATION
         , sum(md.TRANSPORT) as TRANSPORT
         , sum(md.MATERIEL) as MATERIEL
         , sum(md.TUTORAT) as TUTORAT
         , sum(md.COUT_FORMATEUR) as COUT_FORMATEUR
         , sum(md.FRAIS_PERSO_FORMATEUR_INT) as FRAIS_PERSO_FORMATEUR_INT
         , sum(md.FRAIS_PERSO_FORMATEUR_EXT) as FRAIS_PERSO_FORMATEUR_EXT
         , sum(md.LOCAUX_ENTRETIEN) as LOCAUX_ENTRETIEN
         , sum(md.ORGANISATION_ADMINISTRATIVE) as ORGANISATION_ADMINISTRATIVE

         -- Détail des PEC
         , sum(md.PEC_MAINTIEN_SALAIRE_STAGIAIRE) as PEC_MAINTIEN_SALAIRE_STAGIAIRE
         , sum(md.PEC_SALAIRE_HTT) as PEC_SALAIRE_HTT
         , sum(md.PEC_FONCTIONNEMENT_PEDAGO) as PEC_FONCTIONNEMENT_PEDAGO
         , sum(md.PEC_HEBERGEMENT_RESTAURATION) as PEC_HEBERGEMENT_RESTAURATION
         , sum(md.PEC_TRANSPORT) as PEC_TRANSPORT
         , sum(md.PEC_MATERIEL) as PEC_MATERIEL
         , sum(md.PEC_TUTORAT) as PEC_TUTORAT
         , sum(md.PEC_COUT_FORMATEUR) as PEC_COUT_FORMATEUR
         , sum(md.PEC_FRAIS_PERSO_FORMATEUR_INT) as PEC_FRAIS_PERSO_FORMATEUR_INT
         , sum(md.PEC_FRAIS_PERSO_FORMATEUR_EXT) as PEC_FRAIS_PERSO_FORMATEUR_EXT
         , sum(md.PEC_LOCAUX_ENTRETIEN) as PEC_LOCAUX_ENTRETIEN
         , sum(md.PEC_ORGANISATION_ADMIN) as PEC_ORGANISATION_ADMIN

      from V_V5_KRHEF_FORM_MONTANT_DUREE md
      join T_V5_KRHEF_FORMATION_INSCR ins
        on ins.ID_INSCRIPTION = md.ID_INSCRIPTION_REF
      join T_V5_KRHEF_SESSION ses
        on ses.ID_SESSION = ins.ID_SESSION
     where md.FROM_FINANCEMENT = 0
       and ins.ID_ACTEUR_FORM is null
  group by md.ID_INSCRIPTION_REF
         , ses.ID_SESSION_REF
         , md.ORDRE_PLAN
