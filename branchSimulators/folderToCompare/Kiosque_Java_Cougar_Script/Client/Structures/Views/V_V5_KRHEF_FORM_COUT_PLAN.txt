##
V_V5_KRHEF_FORM_COUT_PLAN
=SQL=
CREATE OR REPLACE VIEW V_V5_KRHEF_FORM_COUT_PLAN ("ID_FORM_COUT_PLAN","ID_FORMATION_DEMANDE","ID_FORM_PLAN","ID_AFF_BDG_DETAIL","PLAN_GELE","ID_PLAN","ORDRE_AFF_BDG","ID_PLAN_REPORT","ID_BUDGET","COUT","BUDGET_CHOISI","COUT_SALARIAL","ORDRE_PLAN","COUT_SAL_FORMATEUR","DATE_CREATION","COUT_TRANSPORT","COUT_HEBERGEMENT","DATE_MAJ","COUT_TUTEUR","MATRICULE_MAJ","DATE_RECALCUL_COUTFORMATEUR","PEC_FONCTIONNEMENT_PEDAGO","PEC_SAL_FORMATEUR","PEC_SAL_STAGIAIRE","PEC_TRANSPORT","PEC_HEBERGEMENT","PEC_TUTEUR","MONTANT_SUBV_IND","PRISE_EN_CHARGE_OPCA","PRISE_EN_CHARGE_EMPLOYEUR","PREV_JOURS","PREV_HEURES","PREV_TEMPS_TRAVAIL","PREV_HORS_TEMPS_TRAVAIL","PREV_DIF_TEMPS_TRAVAIL","PREV_DIF_HORS_TEMPS_TRAVAIL","PERCENT_TEMPS_TRAVAIL","PERCENT_HORS_TEMPS_TRAVAIL","PERCENT_DIF_TEMPS_TRAVAIL","PERCENT_DIF_HORS_TEMPS_TRAVAIL","PREV_CPF_TEMPS_TRAVAIL","PREV_CPF_HORS_TEMPS_TRAVAIL","PERCENT_CPF_TEMPS_TRAVAIL","PERCENT_CPF_HORS_TEMPS_TRAVAIL","MONTANT_PEC_OPCA") AS 
select 
cp.ID_FORM_COUT_PLAN
, fp.ID_FORMATION_DEMANDE
, cp.ID_FORM_PLAN
, cp.ID_AFF_BDG_DETAIL
, cp.PLAN_GELE
, fp.ID_PLAN
, cp.ORDRE_AFF_BDG
, fp.ID_PLAN_REPORT
, fp.ID_BUDGET
, cp.COUT
, fp.BUDGET_CHOISI
, cp.COUT_SALARIAL
, fp.ORDRE_PLAN
, cp.COUT_SAL_FORMATEUR
, fp.DATE_CREATION
, cp.COUT_TRANSPORT
, cp.COUT_HEBERGEMENT
, fp.DATE_MAJ
, cp.COUT_TUTEUR
, fp.MATRICULE_MAJ
, fp.DATE_RECALCUL_COUTFORMATEUR
, cp.PEC_FONCTIONNEMENT_PEDAGO
, cp.PEC_SAL_FORMATEUR
, cp.PEC_SAL_STAGIAIRE
, cp.PEC_TRANSPORT
, cp.PEC_HEBERGEMENT
, cp.PEC_TUTEUR
, cp.MONTANT_SUBV_IND
, cp.PRISE_EN_CHARGE_OPCA
, cp.PRISE_EN_CHARGE_EMPLOYEUR
, cp.PREV_JOURS
, cp.PREV_HEURES
, cp.PREV_TEMPS_TRAVAIL
, cp.PREV_HORS_TEMPS_TRAVAIL
, cp.PREV_DIF_TEMPS_TRAVAIL
, cp.PREV_DIF_HORS_TEMPS_TRAVAIL
, cp.PERCENT_TEMPS_TRAVAIL
, cp.PERCENT_HORS_TEMPS_TRAVAIL
, cp.PERCENT_DIF_TEMPS_TRAVAIL
, cp.PERCENT_DIF_HORS_TEMPS_TRAVAIL
, cp.PREV_CPF_TEMPS_TRAVAIL
, cp.PREV_CPF_HORS_TEMPS_TRAVAIL
, cp.PERCENT_CPF_TEMPS_TRAVAIL
, cp.PERCENT_CPF_HORS_TEMPS_TRAVAIL
,(case when dem.INTERNE = 1
                     then (nvl(cp.PEC_SAL_FORMATEUR, 0)
                         + nvl(cp.PEC_SAL_STAGIAIRE, 0)
                         + nvl(cp.PEC_TRANSPORT, 0)
                         + nvl(cp.PEC_HEBERGEMENT, 0)
                         + nvl(cp.PEC_TUTEUR, 0))
                     else (nvl(cp.PEC_FONCTIONNEMENT_PEDAGO, 0)
                         + nvl(cp.PEC_SAL_STAGIAIRE, 0)
                         + nvl(cp.PEC_TRANSPORT, 0)
                         + nvl(cp.PEC_HEBERGEMENT, 0)
                         + nvl(cp.PEC_TUTEUR, 0))
                end) as MONTANT_PEC_OPCA
 from T_V5_KRHEF_FORM_COUT_PLAN cp,
      T_V5_KRHEF_FORM_PLAN fp,
      T_V5_KRHEF_FORM_DEMANDE dem
 where cp.ID_FORM_PLAN = fp.ID_FORM_PLAN
   and dem.ID_FORMATION_DEMANDE = fp.ID_FORMATION_DEMANDE
   and fp.PLAN_GELE = 0
   and cp.PLAN_GELE = 0
   and dem.PLAN_GELE = 0
