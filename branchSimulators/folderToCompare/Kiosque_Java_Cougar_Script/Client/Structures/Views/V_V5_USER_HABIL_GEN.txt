##
V_V5_USER_HABIL_GEN
=SQL=
CREATE OR REPLACE VIEW V_V5_USER_HABIL_GEN  AS 
  WITH ROLE_COLLAB AS (
    SELECT MATRICULE_PAIE,'UTILISATEUR' AS COL,'Entretien' AS ROLE FROM v_v5_krh_salarie_user WHERE EST_UTILISATEUR_ENTR = 1
    UNION ALL
    SELECT MATRICULE_PAIE,'UTILISATEUR' AS COL,'Formation' AS ROLE FROM v_v5_krh_salarie_user WHERE EST_UTILISATEUR_FORM = 1
    UNION ALL
    SELECT MATRICULE_PAIE,'UTILISATEUR' AS COL,'Talent' AS ROLE FROM v_v5_krh_salarie_user WHERE EST_UTILISATEUR_TAL = 1
    UNION ALL
    SELECT MATRICULE_PAIE,'UTILISATEUR' AS COL,'-' AS ROLE FROM v_v5_krh_salarie_user WHERE EST_UTILISATEUR = 0 AND EST_UTILISATEUR_ENTR = 0 AND EST_UTILISATEUR_FORM = 0 AND EST_UTILISATEUR_FORM = 0
    
    UNION ALL
    SELECT MATRICULE_PAIE,'RESPONSABLE' AS COL,'Entretien' AS ROLE FROM v_v5_krh_salarie_user  WHERE EST_RESPONSABLE_ENTR = 1
    UNION ALL
    SELECT MATRICULE_PAIE,'RESPONSABLE' AS COL,'Formation' AS ROLE FROM v_v5_krh_salarie_user WHERE EST_RESPONSABLE_FORM = 1
    UNION ALL
    SELECT MATRICULE_PAIE,'RESPONSABLE' AS COL,'Talent' AS ROLE FROM v_v5_krh_salarie_user WHERE EST_RESPONSABLE_TAL = 1
    UNION ALL
    SELECT MATRICULE_PAIE,'RESPONSABLE' AS COL,'-' AS ROLE FROM v_v5_krh_salarie_user WHERE EST_RESPONSABLE_ENTR = 0 AND EST_RESPONSABLE_FORM = 0 AND EST_RESPONSABLE_TAL = 0
    
    UNION ALL
    SELECT MATRICULE_PAIE,'EXPERT' AS COL,'Entretien' AS ROLE FROM v_v5_krh_salarie_user  WHERE EST_EXPERT_ENTR = 1
    UNION ALL
    SELECT MATRICULE_PAIE,'EXPERT' AS COL,'Formation' AS ROLE FROM v_v5_krh_salarie_user WHERE EST_EXPERT_FORM = 1
    UNION ALL
    SELECT MATRICULE_PAIE,'EXPERT' AS COL,'Talent' AS ROLE FROM v_v5_krh_salarie_user WHERE EST_EXPERT_TAL = 1
    UNION ALL
    SELECT MATRICULE_PAIE,'EXPERT' AS COL,'-' AS ROLE FROM v_v5_krh_salarie_user WHERE EST_EXPERT_ENTR = 0 AND EST_EXPERT_FORM = 0 AND EST_EXPERT_TAL = 0
    
    UNION ALL
    SELECT MATRICULE_PAIE,'GESTIONNAIRE' AS COL,'Entretien' AS ROLE FROM v_v5_krh_salarie_user  WHERE EST_GESTIONNAIRE_ENTR = 1
    UNION ALL
    SELECT MATRICULE_PAIE,'GESTIONNAIRE' AS COL,'Formation' AS ROLE FROM v_v5_krh_salarie_user WHERE EST_GESTIONNAIRE_FORM = 1
    UNION ALL
    SELECT MATRICULE_PAIE,'GESTIONNAIRE' AS COL,'Talent' AS ROLE FROM v_v5_krh_salarie_user WHERE EST_GESTIONNAIRE_TAL = 1
    UNION ALL
    SELECT MATRICULE_PAIE,'GESTIONNAIRE' AS COL,'-' AS ROLE FROM v_v5_krh_salarie_user WHERE EST_GESTIONNAIRE_ENTR = 0 AND EST_GESTIONNAIRE_FORM = 0 AND EST_GESTIONNAIRE_TAL = 0
    
    UNION ALL
    SELECT MATRICULE_PAIE,'DIRECTEUR_RH' AS COL,'Entretien' AS ROLE FROM v_v5_krh_salarie_user  WHERE EST_DIRECTEUR_RH_ENTR = 1
    UNION ALL
    SELECT MATRICULE_PAIE,'DIRECTEUR_RH' AS COL,'Formation' AS ROLE FROM v_v5_krh_salarie_user WHERE EST_DIRECTEUR_RH_FORM = 1
    UNION ALL
    SELECT MATRICULE_PAIE,'DIRECTEUR_RH' AS COL,'Talent' AS ROLE FROM v_v5_krh_salarie_user WHERE EST_DIRECTEUR_RH_TAL = 1
    UNION ALL
    SELECT MATRICULE_PAIE,'DIRECTEUR_RH' AS COL,'-' AS ROLE FROM v_v5_krh_salarie_user WHERE EST_DIRECTEUR_RH_ENTR = 0 AND EST_DIRECTEUR_RH_FORM = 0 AND EST_DIRECTEUR_RH_TAL = 0
    
    UNION ALL
    SELECT MATRICULE_PAIE,'RESPONSABLE_RH' AS COL,'Entretien' AS ROLE FROM v_v5_krh_salarie_user  WHERE EST_RESPONSABLE_RH_ENTR = 1
    UNION ALL
    SELECT MATRICULE_PAIE,'RESPONSABLE_RH' AS COL,'Formation' AS ROLE FROM v_v5_krh_salarie_user WHERE EST_RESPONSABLE_RH_FORM = 1
    UNION ALL
    SELECT MATRICULE_PAIE,'RESPONSABLE_RH' AS COL,'Talent' AS ROLE FROM v_v5_krh_salarie_user WHERE EST_RESPONSABLE_RH_TAL = 1
    UNION ALL
    SELECT MATRICULE_PAIE,'RESPONSABLE_RH' AS COL,'-' AS ROLE FROM v_v5_krh_salarie_user WHERE EST_RESPONSABLE_RH_ENTR = 0 AND EST_RESPONSABLE_RH_FORM = 0 AND EST_RESPONSABLE_RH_TAL = 0
    
    UNION ALL
    SELECT MATRICULE_PAIE,'ACTEUR_INDIRECT' AS COL,'Entretien' AS ROLE FROM v_v5_krh_salarie_user  WHERE EST_ACTEUR_INDIRECT_ENTR = 1
    UNION ALL
    SELECT MATRICULE_PAIE,'ACTEUR_INDIRECT' AS COL,'Formation' AS ROLE FROM v_v5_krh_salarie_user WHERE EST_ACTEUR_INDIRECT_FORM = 1
    UNION ALL
    SELECT MATRICULE_PAIE,'ACTEUR_INDIRECT' AS COL,'Talent' AS ROLE FROM v_v5_krh_salarie_user WHERE EST_ACTEUR_INDIRECT_TAL = 1
    UNION ALL
    SELECT MATRICULE_PAIE,'ACTEUR_INDIRECT' AS COL,'-' AS ROLE FROM v_v5_krh_salarie_user WHERE EST_ACTEUR_INDIRECT_ENTR = 0 AND EST_ACTEUR_INDIRECT_FORM = 0 AND EST_ACTEUR_INDIRECT_TAL = 0
)
SELECT 
NOM||' '||PRENOM AS NP,MATRICULE, MATRICULE_PAIE, 
(SELECT LISTAGG(r.ROLE, (', ')) WITHIN GROUP (ORDER BY r.ROLE) FROM ROLE_COLLAB r WHERE r.MATRICULE_PAIE = t1.MATRICULE_PAIE AND COL = 'UTILISATEUR') AS UTILISATEUR,
(SELECT LISTAGG(r.ROLE, (', ')) WITHIN GROUP (ORDER BY r.ROLE) FROM ROLE_COLLAB r WHERE r.MATRICULE_PAIE = t1.MATRICULE_PAIE AND COL = 'RESPONSABLE') AS RESPONSABLE,
(SELECT LISTAGG(r.ROLE, (', ')) WITHIN GROUP (ORDER BY r.ROLE) FROM ROLE_COLLAB r WHERE r.MATRICULE_PAIE = t1.MATRICULE_PAIE AND COL = 'EXPERT') AS EXPERT,
(SELECT LISTAGG(r.ROLE, (', ')) WITHIN GROUP (ORDER BY r.ROLE) FROM ROLE_COLLAB r WHERE r.MATRICULE_PAIE = t1.MATRICULE_PAIE AND COL = 'GESTIONNAIRE') AS GESTIONNAIRE,
(SELECT LISTAGG(r.ROLE, (', ')) WITHIN GROUP (ORDER BY r.ROLE) FROM ROLE_COLLAB r WHERE r.MATRICULE_PAIE = t1.MATRICULE_PAIE AND COL = 'DIRECTEUR_RH') AS DIRECTEUR_RH,
(SELECT LISTAGG(r.ROLE, (', ')) WITHIN GROUP (ORDER BY r.ROLE) FROM ROLE_COLLAB r WHERE r.MATRICULE_PAIE = t1.MATRICULE_PAIE AND COL = 'RESPONSABLE_RH') AS RESPONSABLE_RH,
(SELECT LISTAGG(r.ROLE, (', ')) WITHIN GROUP (ORDER BY r.ROLE) FROM ROLE_COLLAB r WHERE r.MATRICULE_PAIE = t1.MATRICULE_PAIE AND COL = 'ACTEUR_INDIRECT') AS ACTEUR_INDIRECT,
DECODE(t1.EST_EXPERT_SECURITE,1,'Expert_Sécurité','-') AS EXPERT_SECURITE
FROM v_v5_krh_salarie_user t1
