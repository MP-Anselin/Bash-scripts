##
MISE_AU_PRODUIT
=SQL=
CREATE OR REPLACE PROCEDURE MISE_AU_PRODUIT(p_ID_PROJET IN NUMBER) AS
BEGIN
    -- DELETE REF CONTENT
    DELETE FROM REF_ECRAN WHERE (COMPANY_ID,NOM_PAGE) IN (
        SELECT COMPANY_ID,NOM_PAGE FROM META_ECRAN WHERE ID_PROJET = p_ID_PROJET
    );
    DELETE FROM REF_GROUPE_DONNEES_INFO WHERE (COMPANY_ID,ID_GROUPE) IN (
        SELECT COMPANY_ID,ID_GROUPE FROM META_GROUPE_DONNEES_INFO WHERE ID_PROJET = p_ID_PROJET
    );
    DELETE FROM REF_GROUPE_DONNEES WHERE (COMPANY_ID,ID_GROUPE) IN (
        SELECT COMPANY_ID,ID_GROUPE FROM META_GROUPE_DONNEES_INFO WHERE ID_PROJET = p_ID_PROJET
    );
    DELETE FROM REF_DONNEE_GENERALE WHERE (COMPANY_ID, NOM_DONNEE) IN (
        SELECT COMPANY_ID, NOM_DONNEE FROM META_DONNEE_GENERALE WHERE ID_PROJET = p_ID_PROJET
    );
    DELETE FROM REF_DONNEE_ECRAN WHERE (COMPANY_ID, NOM_DONNEE) IN (
        SELECT COMPANY_ID, NOM_DONNEE FROM META_DONNEE_GENERALE WHERE ID_PROJET = p_ID_PROJET
    );
    DELETE FROM SYS_REQUETES_JSP WHERE (NOMPAGE,IDREQUETE) IN (
        SELECT NOMPAGE,IDREQUETE FROM META_SYS_REQUETES_JSP WHERE ID_PROJET = p_ID_PROJET
    );
    DELETE FROM REF_REGLEGESTION WHERE (COMPANY_ID,ID_REGLEGESTION) IN (
		SELECT COMPANY_ID,ID_REGLEGESTION FROM META_REGLEGESTION_DESC WHERE ID_PROJET = p_ID_PROJET
	);
	DELETE FROM REF_REGLEGESTION_DESC WHERE (COMPANY_ID,ID_REGLEGESTION) IN (
		SELECT COMPANY_ID,ID_REGLEGESTION FROM META_REGLEGESTION_DESC WHERE ID_PROJET = p_ID_PROJET
	);
    DELETE FROM REF_WKF_OPERATION_ECRANS_INFO WHERE (COMPANY_ID,OP_NUM) IN (
		SELECT COMPANY_ID,OP_NUM FROM META_WKF_OPERATION_ECRANS_INFO WHERE ID_PROJET = p_ID_PROJET
	);
    DELETE FROM REF_WKF_OPERATION_ECRANS WHERE (COMPANY_ID,OP_NUM) IN (
		SELECT COMPANY_ID,OP_NUM FROM META_WKF_OPERATION_ECRANS_INFO WHERE ID_PROJET = p_ID_PROJET
	);
    
    -- INSERT META INTO REF
    INSERT INTO REF_ECRAN SELECT * FROM META_ECRAN WHERE ID_PROJET = p_ID_PROJET;
    INSERT INTO REF_GROUPE_DONNEES_INFO SELECT * FROM META_GROUPE_DONNEES_INFO WHERE ID_PROJET = p_ID_PROJET;
    INSERT INTO REF_GROUPE_DONNEES SELECT * FROM META_GROUPE_DONNEES WHERE (COMPANY_ID,ID_GROUPE) IN (
        SELECT COMPANY_ID,ID_GROUPE FROM META_GROUPE_DONNEES_INFO WHERE ID_PROJET = p_ID_PROJET
    );
    INSERT INTO REF_DONNEE_GENERALE SELECT * FROM META_DONNEE_GENERALE WHERE ID_PROJET = p_ID_PROJET;
    INSERT INTO REF_DONNEE_ECRAN SELECT * FROM META_DONNEE_ECRAN WHERE (COMPANY_ID, NOM_DONNEE) IN (
        SELECT COMPANY_ID, NOM_DONNEE FROM META_DONNEE_GENERALE WHERE ID_PROJET = p_ID_PROJET
    );
    INSERT INTO REF_REGLEGESTION SELECT * FROM META_REGLEGESTION WHERE (COMPANY_ID,ID_REGLEGESTION) IN (
		SELECT COMPANY_ID,ID_REGLEGESTION FROM META_REGLEGESTION_DESC WHERE ID_PROJET = p_ID_PROJET
	);
	INSERT INTO REF_REGLEGESTION_DESC SELECT * FROM META_REGLEGESTION_DESC WHERE ID_PROJET = p_ID_PROJET;
    INSERT INTO REF_WKF_OPERATION_ECRANS_INFO SELECT * FROM META_WKF_OPERATION_ECRANS_INFO WHERE ID_PROJET = p_ID_PROJET;
    INSERT INTO REF_WKF_OPERATION_ECRANS SELECT * FROM META_WKF_OPERATION_ECRANS WHERE (COMPANY_ID, OP_NUM) IN (
        SELECT COMPANY_ID, OP_NUM FROM META_WKF_OPERATION_ECRANS_INFO WHERE ID_PROJET = p_ID_PROJET
    );
    INSERT INTO SYS_REQUETES_JSP SELECT 
        NOMPAGE ,
        IDREQUETE ,
        NOMBASE ,
        NOMTABLE ,
        LISTCOLAFF ,
        LISTCOLSET ,
        CLAUSEWHERE ,
        CLAUSEMAX ,
        CLAUSEDISTINCT ,
        CLAUSEORDRE ,
        DESCREQ ,
        LIBREQ ,
        LISTLIBCOLAFF 
    FROM META_SYS_REQUETES_JSP WHERE ID_PROJET = p_ID_PROJET;
    
    -- UNLOCK OBJECT INTO META
    UPDATE META_ECRAN SET ID_PROJET = NULL;
    UPDATE META_GROUPE_DONNEES_INFO SET ID_PROJET = NULL;
    UPDATE META_DONNEE_GENERALE SET ID_PROJET = NULL;
    UPDATE META_REGLEGESTION_DESC SET ID_PROJET = NULL;
    UPDATE META_WKF_OPERATION_ECRANS_INFO SET ID_PROJET = NULL;
    
    -- REMOVE ID_RPOJET INTO REF
    UPDATE REF_ECRAN SET ID_PROJET = NULL;
    UPDATE REF_GROUPE_DONNEES_INFO SET ID_PROJET = NULL;
    UPDATE REF_DONNEE_GENERALE SET ID_PROJET = NULL;
    UPDATE REF_REGLEGESTION_DESC SET ID_PROJET = NULL;
    UPDATE REF_WKF_OPERATION_ECRANS_INFO SET ID_PROJET = NULL;
END MISE_AU_PRODUIT;
